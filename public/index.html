<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Maserati & Alfa Romeo — 2026</title>

  <!-- Font -->
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@500;700;800&display=swap" rel="stylesheet">

  <!-- CSS -->
  <link rel="stylesheet" href="../css/page.css">
</head>
<body>

  <!-- ========================= HERO / BANNER ========================= -->
  <section class="block" id="hero">
    <span class="label">HERO / BANNER</span>

    <div class="header">
      <div class="top-container">
        <div class="logo">
          <img src="../images/ChatGPT Image Aug 7, 2025, 01_41_39 AM.png" alt="Maserati & Alfa Romeo">
        </div>

        <nav id="navbar" aria-label="Primary">
          <ul>
            <li><a href="#easy-steps">Easy steps</a></li>
            <li><a href="#about-ma-ar">About us</a></li>
            <li><a href="#block-7">Why us</a></li>
            <li><a href="#clients-say">Testimonials</a></li>
            <li><a href="https://alfaromeowinnipeg.ca/inventory-page-used" rel="noopener" data-inventory-link>Inventory</a></li>
          </ul>
        </nav>

        <div class="logo">
          <img src="../images/ChatGPT Image Aug 7, 2025, 02_08_15 AM.png" alt="Maserati & Alfa Romeo">
        </div>
      </div>

      <div class="banner">
        <h2>Drive Your Dream Car Today</h2>
        <p>$0 Down Options | Top $ for Trade-In | All Credit Welcome</p>
      </div>

      <div id="btncontainer">
        <!-- Triggers for tunnel -->
        <a class="approved" href="#alfa-specials" data-tunnel-trigger="get-started">Get me approved</a>
        <a class="learn-more" href="#alfa-specials" data-tunnel-trigger="get-best-deal">Get the best deal</a>
      <a class="refer-btn" href="#refer-friend" data-refer-open id="referHeroBtn">
  Refer a friend
</a>

      </div>
    </div>


</section>

    <div class="middle-container" aria-hidden="true">
<!-- ===== ORBITAL LANE (evenly spaced + pre-filled) ===== -->
<style>
  /* Give this section positioning context */
  .middle-container{ position: relative; }

  /* Lane at the very top of the Levante/diagonal block */
  .orbit-top{
    position:absolute;
    left:0; right:0;
    top:6px;                 /* tweak up/down to taste */
    height:90px;
    pointer-events:none;
    z-index:6;               /* above this block’s bg, under anything else */
    overflow:visible;
  }
  .orbit-lane{ position:relative; width:100%; height:100%; }

  /* One item per logo, all share the same duration */
  .orbit-item{
    position:absolute; top:0;
    /* full cycle time — keep linear for even spacing */
    --T: 32s;
    animation: slideAcross var(--T) linear infinite both;
    animation-delay: var(--d, 0s);  /* negative delays pre-fill the lane */
    opacity:0;
    will-change: transform, opacity;
  }

  /* The image itself (small vertical “breath” so it feels alive) */
  .orbit-item img{
    width:86px; height:86px; object-fit:contain;
    filter: drop-shadow(0 6px 16px rgba(0,0,0,.35));
    animation: bob 6s ease-in-out infinite;
  }

  /* Constant horizontal speed; fade in/out at the ends */
  @keyframes slideAcross{
    0%   { transform: translateX(-18vw); opacity:0; }
    3%   { opacity:1; }
    97%  { opacity:1; }
    100% { transform: translateX(120vw); opacity:0; }
  }
  @keyframes bob{
    0%,100% { transform: translateY(0); }
    50%     { transform: translateY(-2px); }
  }

  /* Responsive lane & logo size */
  @media (max-width: 900px){
    .orbit-top{ top:4px; height:72px; }
    .orbit-item img{ width:64px; height:64px; }
  }
</style>

<div class="orbit-top" aria-hidden="true">
  <div class="orbit-lane">
    <!-- 16 brands, evenly spaced: step = -2s across a 32s cycle -->
    <div class="orbit-item" style="--d:-0s"><img src="/images/car-logos-white/toyota-white.svg"      alt="Toyota"></div>
    <div class="orbit-item" style="--d:-2s"><img src="../images/car-logos-white/honda.svg"       alt="Honda"></div>
    <div class="orbit-item" style="--d:-4s"><img src="/images/car-logos-white/nissan.svg"      alt="Nissan"></div>
    <div class="orbit-item" style="--d:-6s"><img src="/images/car-logos-white/mercedes.svg"    alt="Mercedes-Benz"></div>
    <div class="orbit-item" style="--d:-8s"><img src="../images/car-logos-white/infiniti.svg"    alt="INFINITI"></div>
    <div class="orbit-item" style="--d:-10s"><img src="../images/car-logos-white/ford.svg"        alt="Ford"></div>
    <div class="orbit-item" style="--d:-12s"><img src="../images/car-logos-white/ram.svg"         alt="RAM"></div>
    <div class="orbit-item" style="--d:-14s"><img src="../images/car-logos-white/jeep.svg"        alt="Jeep"></div>
    <div class="orbit-item" style="--d:-16s"><img src="../images/car-logos-white/chrysler.svg"    alt="Chrysler"></div>
    <div class="orbit-item" style="--d:-18s"><img src="../images/car-logos-white/chevrolet.svg"   alt="Chevrolet"></div>
    <div class="orbit-item" style="--d:-20s"><img src="../images/car-logos-white/bmw.svg"    alt="Maserati"></div>
    <div class="orbit-item" style="--d:-22s"><img src="../images/car-logos-white/audi.svg"  alt="Alfa Romeo"></div>
    <div class="orbit-item" style="--d:-24s"><img src="../images/car-logos-white/acura.svg"       alt="Acura"></div>
    <div class="orbit-item" style="--d:-26s"><img src="../images/car-logos-white/cadillac.svg"  alt="Mitsubishi"></div>
    <div class="orbit-item" style="--d:-28s"><img src="../images/car-logos-white/mazda.svg"       alt="Mazda"></div>
    <div class="orbit-item" style="--d:-30s"><img src="../images/car-logos-white/bmw-white.svg"     alt="Lincoln"></div>
  </div>
</div>
<!-- ===== /ORBITAL LANE ===== -->


      <div class="deal-container"></div>
      <div class="deal-image"></div>
    </div>
  </section>

<!-- ========================= FEATURED VEHICLES (scoped) ========================= -->
<section class="featured-block" id="featured-vehicles" aria-label="Featured vehicles">
  <style>
    /* ====== Scoped styles (prefix: fvx-) ====== */
    #featured-vehicles { --ink:#0b1220; --fg:#eaf2ff; --muted:#9fb3d9; --ring:#e6eaf2;
      --card:#0f141c; --badge:#d0001a; --accent1:#C22636; --accent2:#971B29;
      scroll-margin-top: 80px;
    }
    #featured-vehicles .fvx-head{display:grid;justify-items:center;gap:6px;margin-bottom:14px}
    #featured-vehicles .fvx-head h2{margin:0;font-weight:900;letter-spacing:.02em}
    #featured-vehicles .fvx-sub{margin:0;color:#6f7f9d;font-weight:800}
    #featured-vehicles .fvx-underline{width:120px;height:6px;border-radius:999px;background:linear-gradient(90deg,var(--accent1),var(--accent2));opacity:.6}

    /* shell */
    #featured-vehicles .fvx-shell{position:relative}
    #featured-vehicles .fvx-viewport{
      overflow:auto; scroll-snap-type:x mandatory;
      -webkit-overflow-scrolling:touch;
      padding:4px 6px 10px;
    }
    #featured-vehicles .fvx-track{
      display:grid; grid-auto-flow:column; gap:16px; align-items:stretch;
      min-width:min(100%, 320px);
    }

    /* arrows */
    #featured-vehicles .fvx-nav{
      position:absolute; top:50%; transform:translateY(-50%);
      width:44px;height:44px;border-radius:999px;border:0;cursor:pointer;
      background:#111827; color:#fff; box-shadow:0 10px 28px rgba(0,0,0,.35);
      display:grid; place-items:center; font-size:22px;
    }
    #featured-vehicles .fvx-prev{left:-6px}
    #featured-vehicles .fvx-next{right:-6px}
    /* ensure arrows sit above the scroller */
#featured-vehicles .fvx-shell{ position: relative; }
#featured-vehicles .fvx-viewport{ position: relative; z-index: 0; }
#featured-vehicles .fvx-nav{ z-index: 3; }

    @media (max-width: 900px){ #featured-vehicles .fvx-prev{left:4px} #featured-vehicles .fvx-next{right:4px} }

    /* card */
    #featured-vehicles .fvx-card{
      background:var(--card); color:var(--fg); border-radius:18px; overflow:hidden;
      min-width:290px; width:clamp(290px, 28vw, 360px);
      box-shadow:0 22px 60px rgba(0,0,0,.25);
      scroll-snap-align:start; isolation:isolate;
      display:grid; grid-template-rows:auto 1fr;
    }
    #featured-vehicles .fvx-media{position:relative; aspect-ratio:16/9; background:#0b0f14}
    #featured-vehicles .fvx-media img{width:100%;height:100%;object-fit:cover;display:block}
    #featured-vehicles .fvx-badge{
      position:absolute; top:10px; left:10px;
      background:var(--badge); color:#fff; font-weight:900; border-radius:10px;
      padding:4px 8px; font-size:12px; letter-spacing:.02em;
    }

    #featured-vehicles .fvx-body{padding:12px}
    #featured-vehicles .fvx-title{margin:0 0 4px;font-weight:900;font-size:16px;line-height:1.25}
    #featured-vehicles .fvx-trim{opacity:.85;font-weight:800;margin:0 0 6px}
    #featured-vehicles .fvx-meta{display:flex;flex-wrap:wrap;gap:10px;opacity:.8;font-size:13px;margin-bottom:10px}
    #featured-vehicles .fvx-meta span{white-space:nowrap}

    #featured-vehicles .fvx-price{
      display:flex; align-items:flex-end; justify-content:space-between; margin:8px 0 12px;
    }
    #featured-vehicles .fvx-pay strong{font-size:20px; color:#fff}
    #featured-vehicles .fvx-pay small{display:block;color:#9fb3d9;font-weight:800}
    #featured-vehicles .fvx-sale{display:grid; justify-items:end}
    #featured-vehicles .fvx-sale .label{font-size:12px; color:#ff99a6; font-weight:900}
    #featured-vehicles .fvx-sale .value{font-size:22px; font-weight:900; color:#fff}

    #featured-vehicles .fvx-actions{display:flex;gap:8px}
    #featured-vehicles .fvx-btn{
      appearance:none; border:0; cursor:pointer; border-radius:12px; padding:10px 14px;
      font-weight:900; letter-spacing:.02em; text-decoration:none; display:inline-block;
    }
    #featured-vehicles .fvx-btn.shop{background:#fff; color:#111}
    #featured-vehicles .fvx-btn.approve{background:linear-gradient(90deg,var(--accent1),var(--accent2)); color:#fff}

    /* keep things neat on narrow screens */
    @media (max-width:700px){
      #featured-vehicles .fvx-card{min-width:86vw; width:86vw}
    }
  </style>

  <div class="label">FEATURED VEHICLES</div>
  <div class="fvx-head">
    <h2>FEATURED VEHICLES</h2>
    <span class="fvx-underline" aria-hidden="true"></span>
    <p class="fvx-sub">We have priced these units to move!</p>
  </div>

  <div class="fvx-shell">
    <button class="fvx-nav fvx-prev" type="button" aria-label="Previous">‹</button>
    <div class="fvx-viewport" id="fvxViewport" aria-live="polite">
      <ul class="fvx-track" id="fvxTrack">
        <!-- 1 -->
        <li class="fvx-card">
          <figure class="fvx-media">
            <img src="../images/Cars/2020%20rav.webp" alt="2020 Toyota RAV4 AWD LE">
            <span class="fvx-badge">used</span>
          </figure>
          <div class="fvx-body">
            <h3 class="fvx-title">2020 TOYOTA RAV4 AWD</h3>
            <p class="fvx-trim">LE</p>
            <div class="fvx-meta"><span>103,590 KM</span><span>Stock # 7299</span></div>
            <div class="fvx-price">
              <div class="fvx-pay"><strong>$183</strong><small>Bi-Weekly</small></div>
              <div class="fvx-sale"><span class="label">SALE PRICE</span><span class="value">$27,995</span></div>
            </div>
            <div class="fvx-actions">
              <a class="fvx-btn shop" href="#alfa-specials" data-tunnel-trigger="shop-now">Shop Now</a>
              <a class="fvx-btn approve" href="#alfa-specials" data-tunnel-trigger="get-started">Get Me Approved</a>
            </div>
          </div>
        </li>
        <!-- 2 -->
        <li class="fvx-card">
          <figure class="fvx-media">
            <img src="../images/Cars/cars real/Accord real.webp" alt="2018 Honda Accord Sedan EX-L">
            <span class="fvx-badge">used</span>
          </figure>
          <div class="fvx-body">
            <h3 class="fvx-title">2018 HONDA ACCORD SEDAN 4X2</h3>
            <p class="fvx-trim">EX-L</p>
            <div class="fvx-meta"><span>152,011 KM</span><span>Stock # 7328</span></div>
            <div class="fvx-price">
              <div class="fvx-pay"><strong>$150</strong><small>Bi-Weekly</small></div>
              <div class="fvx-sale"><span class="label">SALE PRICE</span><span class="value">$22,995</span></div>
            </div>
            <div class="fvx-actions">
              <a class="fvx-btn shop" href="#alfa-specials" data-tunnel-trigger="shop-now">Shop Now</a>
              <a class="fvx-btn approve" href="#alfa-specials" data-tunnel-trigger="get-started">Get Me Approved</a>
            </div>
          </div>
        </li>
        <!-- 3 -->
        <li class="fvx-card">
          <figure class="fvx-media">
            <img src="../images/Cars/cars real/crv real.webp" alt="2020 Honda CR-V EX-L 4x4">
            <span class="fvx-badge">used</span>
          </figure>
          <div class="fvx-body">
            <h3 class="fvx-title">2020 HONDA CR-V 4X4</h3>
            <p class="fvx-trim">EX-L</p>
            <div class="fvx-meta"><span>127,277 KM</span><span>Stock # 7260</span></div>
            <div class="fvx-price">
              <div class="fvx-pay"><strong>$189</strong><small>Bi-Weekly</small></div>
              <div class="fvx-sale"><span class="label">SALE PRICE</span><span class="value">$28,995</span></div>
            </div>
            <div class="fvx-actions">
              <a class="fvx-btn shop" href="#alfa-specials" data-tunnel-trigger="shop-now">Shop Now</a>
              <a class="fvx-btn approve" href="#alfa-specials" data-tunnel-trigger="get-started">Get Me Approved</a>
            </div>
          </div>
        </li>
        <!-- 4 -->
        <li class="fvx-card">
          <figure class="fvx-media">
            <img src="../images/Cars/2021%20ford.webp" alt="2021 Ford F-150 Lariat 4x4">
            <span class="fvx-badge">used</span>
          </figure>
          <div class="fvx-body">
            <h3 class="fvx-title">2021 FORD F-150 4X4</h3>
            <p class="fvx-trim">LARIAT</p>
            <div class="fvx-meta"><span>262,855 KM</span><span>Stock # P1689</span></div>
            <div class="fvx-price">
              <div class="fvx-pay"><strong>$136</strong><small>Bi-Weekly</small></div>
              <div class="fvx-sale"><span class="label">SALE PRICE</span><span class="value">$20,900</span></div>
            </div>
            <div class="fvx-actions">
              <a class="fvx-btn shop" href="#alfa-specials" data-tunnel-trigger="shop-now">Shop Now</a>
              <a class="fvx-btn approve" href="#alfa-specials" data-tunnel-trigger="get-started">Get Me Approved</a>
            </div>
          </div>
        </li>
        <!-- 5 -->
        <li class="fvx-card">
          <figure class="fvx-media">
            <img src="../images/Cars/cars real/cruze real.webp" alt="2015 Chevrolet Cruze 1LT">
            <span class="fvx-badge">used</span>
          </figure>
          <div class="fvx-body">
            <h3 class="fvx-title">2015 CHEVROLET CRUZE</h3>
            <p class="fvx-trim">1LT</p>
            <div class="fvx-meta"></div>
            <div class="fvx-price">
              <div class="fvx-pay"><strong>$42</strong><small>Bi-Weekly</small></div>
              <div class="fvx-sale"><span class="label">SALE PRICE</span><span class="value">$6,495</span></div>
            </div>
            <div class="fvx-actions">
              <a class="fvx-btn shop" href="#alfa-specials" data-tunnel-trigger="shop-now">Shop Now</a>
              <a class="fvx-btn approve" href="#alfa-specials" data-tunnel-trigger="get-started">Get Me Approved</a>
            </div>
          </div>
        </li>
        <!-- 6 -->
        <li class="fvx-card">
          <figure class="fvx-media">
            <img src="../images/Cars/cars real/ram real.webp" alt="2017 Ram 1500 4x4 Sport">
            <span class="fvx-badge">used</span>
          </figure>
          <div class="fvx-body">
            <h3 class="fvx-title">2017 RAM 1500 4X4</h3>
            <p class="fvx-trim">SPORT</p>
            <div class="fvx-meta"><span>189,578 KM</span><span>Stock # P1696</span></div>
            <div class="fvx-price">
              <div class="fvx-pay"><strong>$130</strong><small>Bi-Weekly</small></div>
              <div class="fvx-sale"><span class="label">SALE PRICE</span><span class="value">$19,900</span></div>
            </div>
            <div class="fvx-actions">
              <a class="fvx-btn shop" href="#alfa-specials" data-tunnel-trigger="shop-now">Shop Now</a>
              <a class="fvx-btn approve" href="#alfa-specials" data-tunnel-trigger="get-started">Get Me Approved</a>
            </div>
          </div>
        </li>
        <!-- 7 -->
        <li class="fvx-card">
          <figure class="fvx-media">
            <img src="../images/Cars/audi.webp" alt="2010 Audi Q5 3.2L Premium">
            <span class="fvx-badge">used</span>
          </figure>
          <div class="fvx-body">
            <h3 class="fvx-title">2010 AUDI Q5</h3>
            <p class="fvx-trim">3.2L Premium</p>
            <div class="fvx-meta"></div>
            <div class="fvx-price">
              <div class="fvx-pay"><strong>$59</strong><small>Bi-Weekly</small></div>
              <div class="fvx-sale"><span class="label">SALE PRICE</span><span class="value">$8,995</span></div>
            </div>
            <div class="fvx-actions">
              <a class="fvx-btn shop" href="#alfa-specials" data-tunnel-trigger="shop-now">Shop Now</a>
              <a class="fvx-btn approve" href="#alfa-specials" data-tunnel-trigger="get-started">Get Me Approved</a>
            </div>
          </div>
        </li>
        <!-- 8 -->
        <li class="fvx-card">
          <figure class="fvx-media">
            <img src="..//images/Cars/cars real/crysler real.webp" alt="2018 Chrysler 300 AWD 300S Accident Free">
            <span class="fvx-badge">used</span>
          </figure>
          <div class="fvx-body">
            <h3 class="fvx-title">2018 CHRYSLER 300 AWD</h3>
            <p class="fvx-trim">300S AWD • Accident Free</p>
            <div class="fvx-meta"><span>158,442 KM</span><span>Stock # 7341</span></div>
            <div class="fvx-price">
              <div class="fvx-pay"><strong>$117</strong><small>Bi-Weekly</small></div>
              <div class="fvx-sale"><span class="label">SALE PRICE</span><span class="value">$17,995</span></div>
            </div>
            <div class="fvx-actions">
              <a class="fvx-btn shop" href="#alfa-specials" data-tunnel-trigger="shop-now">Shop Now</a>
              <a class="fvx-btn approve" href="#alfa-specials" data-tunnel-trigger="get-started">Get Me Approved</a>
            </div>
          </div>
        </li>
      </ul>
    </div>
    <button class="fvx-nav fvx-next" type="button" aria-label="Next">›</button>
  </div>

  <script>
    // ===== scoped carousel controls (no outside dependencies) =====
    (function(){
      const vp = document.getElementById('fvxViewport');
      const prev = document.querySelector('#featured-vehicles .fvx-prev');
      const next = document.querySelector('#featured-vehicles .fvx-next');
      if (!vp || !prev || !next) return;

      function step(dir){ vp.scrollBy({left: dir * Math.round(vp.clientWidth * .9), behavior:'smooth'}); }
      prev.addEventListener('click', ()=>step(-1));
      next.addEventListener('click', ()=>step(1));

      // If some other old script tries to overwrite this area, quietly block it.
      const track = document.getElementById('fvxTrack');
      const mo = new MutationObserver(()=> {
        // keep only fvx-cards inside this track
        [...track.children].forEach(node => { if (!node.classList?.contains('fvx-card')) node.remove(); });
      });
      mo.observe(track, {childList:true});
    })();
  </script>
</section>

<section id="inventory" class="featured-block" aria-label="Live inventory">
  <div class="label">INVENTORY</div>
  <div class="fvx-head">
    <h2>INVENTORY</h2>
    <span class="fvx-underline" aria-hidden="true"></span>
    <p class="fvx-sub">Live feed from our used inventory.</p>
  </div>

  <div class="fvx-shell">
    <button class="fvx-nav fvx-prev" type="button" aria-label="Previous">‹</button>
    <div class="fvx-viewport" id="invViewport" aria-live="polite">
      <ul class="fvx-track" id="invTrack"></ul>
    </div>
    <button class="fvx-nav fvx-next" type="button" aria-label="Next">›</button>
  </div>
</section>


  <!-- ========================= EASY STEPS ========================= -->
  <section class="how-it-works" id="how-it-works" aria-label="Easy steps">
    <div id="easy-steps" style="position:relative; top:-80px;"></div>

    <div class="label">EASY STEPS</div>
    <h2>EASY STEPS</h2>
    <p class="sub">We’ve streamlined auto financing into three simple steps to get you behind the wheel fast.</p>
    <div class="steps">
      <article class="step">
        <div class="icon-wrap">
          <svg class="icon" viewBox="0 0 24 24" aria-hidden="true"><path d="M7 2h10a2 2 0 0 1 2 2v16l-3-2-3 2-3-2-3 2V4a2 2 0 0 1 2-2zm2 5h6v2H9V7zm0 4h6v2H9v-2zm-2 6h10v-1.382l-2 1.334-3-2-3 2-2-1.334V17z"/></svg>
        </div>
        <h3>APPLY ONLINE</h3>
        <p>Start with our quick, secure application. Pick your vehicle, set your budget, and we’ll reach out to confirm details.</p>
      </article>
      <article class="step">
        <div class="icon-wrap">
          <svg class="icon" viewBox="0 0 24 24" aria-hidden="true"><path d="M2 12l5-5 5 5-5 5-5-5zm15-5h3a2 2 0 0 1 2 2v3l-5 5-5-5 5-5zM7 7h5l-2.5 2.5L7 7zm5 10l2 2 5-5-2-2-5 5z"/></svg>
        </div>
        <h3>GET THE BEST DEAL</h3>
        <p>We review your application, discuss options, and present tailored approvals for maximum value.</p>
      </article>
      <article class="step">
        <div class="icon-wrap">
          <svg class="icon" viewBox="0 0 24 24" aria-hidden="true"><path d="M7 2a1 1 0 0 1 1 1v1h8V3a1 1 0 1 1 2 0v1h1a2 2 0 0 1 2 2v3H3V6a2 2 0 0 1 2-2h1V3a1 1 0 0 1 1-1zM3 11h18v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-7zm9 2a1 1 0 0 1 1 1v3h3a1 1 0 1 1 0 2h-4a1 1 0 0 1-1-1v-4a1 1 0 0 1 1-1z"/></svg>
        </div>
        <h3>SCHEDULE IN-PERSON APPOINTMENT</h3>
        <p>Lock in a time to visit the showroom, test drive, and finalize paperwork on your schedule.</p>
      </article>
    </div>
  </section>

  <!-- ========================= ALFA SPECIALS (with Winter inside) ========================= -->
  <section class="specials-section" id="alfa-specials" aria-label="Alfa Romeo specials">
    <div class="label">ALFA ROMEO SPECIALS + Winter</div>
    <div class="specials-wrap">
      <header class="specials-head">
        <span class="eyebrow">Limited-Time Alfa Romeo Specials</span>
        <h2 class="title">Drive these offers while they last</h2>
        <p class="sub">Rates from <strong>1.15%</strong> + up to <strong>$1,150</strong> in incentives.</p>
      </header>

      <div class="deal-grid">

<!-- REFER A FRIEND CARD -->
<article class="deal-card refer-card" id="referCard" data-bg="../images/Refer%20a%20Friend.png">
  <div class="deal-hero">
    <div class="deal-topline">REFER & EARN</div>
    <h3 class="deal-heading">Refer a friend<br><span>Get a kickback</span></h3>
    <div class="deal-deadline">ONGOING</div>
  </div>
  <div class="deal-band">
<img class="brand-badge" src="../images/refer%20friend%203.png" alt="Refer a Friend">
    <div class="band-col">
      <div class="band-label">Your kickback</div>
      <div class="band-value">$250</div>
      <div class="band-foot">after friend’s purchase</div>
    </div>
    <div class="band-plus">+</div>
    <div class="band-col">
      <div class="band-label">Friend’s bonus</div>
      <div class="band-value">Full Tank</div>
      <div class="band-foot">+ surprise gift</div>
    </div>
  </div>
  <div class="deal-ctas">
    <a class="cta primary" href="#refer-friend" data-refer-open id="referStartBtn">Refer Now</a>
    <button class="disclaimer-btn js-disclaimer" aria-expanded="false">Click for terms</button>
  </div>
  <div class="disclaimer hidden" tabindex="-1">
    Earn $250 via e-transfer when your referred friend purchases within 60 days.
    Friend must mention you at first contact. One payout per sold referral. Terms may change.
  </div>
</article>

        <!-- Winter CALLOUT -->
        <aside class="Winter-callout" id="Winter-card">
          <div class="Winter-inner">
            <span class="Winter-badge" aria-label="Winter Bonus Code">
              <svg viewBox="0 0 24 24" fill="none" width="18" height="18" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
                <path d="M3 8a3 3 0 0 1 3-3h12a3 3 0 0 1 3 3v2a2 2 0 1 0 0 4v2a3 3 0 0 1-3 3H6a3 3 0 0 1-3-3v-2a2 2 0 1 0 0-4V8Z" stroke="currentColor" stroke-width="1.5"/>
              </svg>
              Winter Bonus Code
            </span>
            <h3 class="Winter-title">Claim your <em>Winter Bonus Code</em> in 60 seconds</h3>
            <p class="Winter-sub">Full Tank of Gas, Visa Gift Card & Surprise Bonus after your in-person appointment and purchase.</p>
            <div class="perk-list">
              <div class="perk-item">
                <svg viewBox="0 0 24 24" width="28" height="28" fill="none" aria-hidden="true"><path d="M4 3h4l2 4h6a2 2 0 0 1 2 2v8a3 3 0 1 1-6 0H9a3 3 0 1 1-6 0V5a2 2 0 0 1 2-2Z" stroke="currentColor" stroke-width="1.4"/></svg>
                <div>Full Tank of Gas on delivery</div>
              </div>
              <div class="perk-item">
                <svg viewBox="0 0 24 24" width="28" height="28" fill="none" aria-hidden="true"><rect x="3" y="5" width="18" height="14" rx="2" stroke="currentColor" stroke-width="1.4"/></svg>
                <div>Visa Gift Card — use anywhere</div>
              </div>
              <div class="perk-item">
                <svg viewBox="0 0 24 24" width="28" height="28" fill="none" aria-hidden="true"><path d="M12 3l2.6 5.3 5.9.9-4.3 4.2 1 5.9L12 16.7 6.8 19.3l1-5.9L3.5 9.2l5.9-.9L12 3Z" stroke="currentColor" stroke-width="1.4"/></svg>
                <div>Surprise Bonus at delivery</div>
              </div>
            </div>
            <div class="Winter-cta-row">
              <button class="Winter-btn" id="openWinterModalBtn" aria-haspopup="dialog" aria-controls="WinterModal" data-tunnel-trigger="book-appointment">Book Appointment</button>
<button
  class="Winter-btn outline"
  id="claimNowBtn"
  aria-haspopup="dialog"
  aria-controls="WinterModal"
>
  Claim Now
</button>
            </div>
            <small class="Winter-sub">*One code per household. While supplies last.</small>
            <div><strong>Reserved Code Preview:</strong> <span id="WinterPreview" class="mono-tight">Winter-••••-••••</span></div>
          </div>
        </aside>

        <!-- TONALE -->
        <article class="deal-card" data-bg="images/specials/tonale-hero.jpg" data-deal="tonale">
          <div class="deal-hero">
            <div class="deal-topline">ON ALL</div>
            <h3 class="deal-heading">2025 ALFA ROMEO<br><span>TONALE</span></h3>
            <div class="deal-deadline" data-deadline="2025-09-02">ENDS SEPT 2ND, 2025</div>
          </div>
          <div class="deal-band">
            <img class="brand-badge" src="../images/Tonale.png" alt="Alfa Romeo badge">
            <div class="band-col"><div class="band-label">RATES STARTING<br>AT</div><div class="band-value rate">1.15%</div></div>
            <div class="band-plus">+</div>
            <div class="band-col"><div class="band-label">GET</div><div class="band-value cash">$1,150</div><div class="band-foot">IN TOTAL INCENTIVES</div></div>
          </div>
          <div class="deal-ctas">
            <!-- Triggers for tunnel -->
            <a class="cta primary" href="#featured-vehicles" data-tunnel-trigger="shop-now">SHOP NOW</a>
            <a class="cta secondary" href="#contact-us">CONTACT US</a>
            <button class="disclaimer-btn js-disclaimer" aria-expanded="false">CLICK FOR DISCLAIMER</button>
          </div>
          <div class="disclaimer hidden">
            <p>Finance OAC. Example rate 1.15% on approved credit. Incentive amounts and eligibility may vary by trim and region. Offers end on or before the posted deadline or while supplies last. See dealer for full details.</p>
          </div>
        </article>
      </div>
    </div>
  </section>

  <!-- ========================= ABOUT / CTA / APPOINTMENT / WHY / PICK-PAYMENT / REVIEWS ========================= -->
<section id="about-ma-ar" class="block" aria-label="Who we are"
  style="--hero:url('../images/about/hero-maserati-alfa.jpg'); --sub:url('../images/Who%20Are%20we/Our%20Commitment.png')">
    <div class="label">WHO WE ARE</div>
    <div class="about-wrap">
      <div class="about-grid">
        <div class="who-block">
          <h2 class="about-h1">Who we are <span class="muted">—</span> <em>Maserati & Alfa Romeo</em></h2>
          <div class="rule"></div>
          <p class="about-p">Where Italian performance meets craftsmanship. As an authorized retailer of <strong>Maserati</strong> and <strong>Alfa Romeo</strong>, we pair iconic design with a buying experience that’s modern and transparent.</p>
          <p class="about-p muted">From curated inventories and bespoke finance options to Winter delivery, our team makes ownership effortless—whether it’s your first Trident or your next Quadrifoglio.</p>
        </div>
<figure class="hero" aria-label="Maserati & Alfa Romeo driving shot"
        style="background-image:url('../images/Who%20Are%20we/Who%20are%20we.png');"></figure>
        <figure class="sub-photo" aria-label="Advisor with guest in showroom"></figure>
        <div class="commit-block">
          <h3 class="about-h2">Our Commitment</h3>
          <div class="rule"></div>
          <p class="about-p">Clear pricing, flexible finance, and test drives that fit your schedule.</p>
          <p class="about-p muted">Expect concierge-level care, certified technicians, and delivery experiences worthy of the badge—every time.</p>
        </div>
      </div>
    </div>
  </section>

  <section class="cta-block" id="cta-primary" aria-label="Start today">
    <div class="label">PRIMARY CTA</div>
    <h2>Your New Ride Awaits!</h2>
    <p>Start Your Auto Finance Journey Today — quick, personalized, and hassle-free.</p>
    <a href="#alfa-specials" class="cta-btn" data-tunnel-trigger="get-started">Get Started</a>
  </section>

  <section id="book-banner" class="block" aria-label="Trade-in & appointment">
    <div class="label">TRADE-IN & APPOINTMENT</div>
    <div class="ab-wrap">
      <div>
        <div class="eyebrow">Top Dollar For Your Trade-In</div>
        <h2 class="headline">Trade In & Upgrade Your Ride</h2>
        <p class="sub">We pay <strong>top dollar</strong> for your trade-in. Book your in-person appointment to get started.</p>
      </div>
      <div>
        <!-- Triggers for tunnel -->
        <a class="cta-ghost" href="#alfa-specials" data-tunnel-trigger="schedule-appointment">Schedule Appointment</a>
        <a class="cta-red" href="#pick-payment" data-tunnel-trigger="get-best-deal">Get Trade-In Offer</a>
      </div>
    </div>
  </section>

  <section class="why-choose" id="block-7" aria-label="Why choose us">
    <div class="label">WHY CHOOSE US</div>
    <div class="wc-head">
      <h2>Why Choose Us</h2>
      <p class="wc-sub"><strong>Exceptional Service, Tailored Solutions</strong> – Discover why our unique approach to auto financing sets us apart.</p>
      <span class="wc-underline" aria-hidden="true"></span>
    </div>
    <div class="wc-grid">
      <article class="wc-card"><div class="wc-media"><img src="images/Why Choose us/All Credit Welcome.png" alt="Trusted lenders logos"></div><div class="wc-body"><h3>Credit-Friendly Process</h3><p>We match you with select lenders more likely to approve your loan.</p></div></article>
      <article class="wc-card"><div class="wc-media"><img src="images/Why Choose us/Extensive Selection Slot.png"Row of vehicles"></div><div class="wc-body"><h3>Extensive Selection</h3><p>From brand new to pre-owned, domestic and import.</p></div></article>
      <article class="wc-card"><div class="wc-media"><img src="images/Why Choose us/Personalized Financing.png" alt="Customer receiving keys"></div><div class="wc-body"><h3>Personalized Financing</h3><p>Tailored options with highly competitive offers.</p></div></article>
      <article class="wc-card"><div class="wc-media"><img src="images/Why Choose us/Fast & Convenient.png" alt="Finance approval"></div><div class="wc-body"><h3>Fast & Convenient</h3><p>Quick approvals and streamlined online processing.</p></div></article>
      <article class="wc-card"><div class="wc-media"><img src="images/Why Choose us/Credit-Friendly Process Slot.png" alt="Excellent credit score"></div><div class="wc-body"><h3>All Credit Welcome</h3><p>Options for every situation.</p></div></article>
      <article class="wc-card"><div class="wc-media"><img src="images/Why%20Choose%20us/Dedicated%20Support.png" alt="Dedicated support team"></div><div class="wc-body"><h3>Dedicated Support</h3><p>We’re with you through every step.</p></div></article>
    </div>
  </section>

  <section id="pick-payment" class="block" aria-label="Pick a car and a payment">
    <div class="label">PICK A CAR & PAYMENT</div>
    <div class="pp-wrap">
      <h2 class="pp-title">Pick A Car & A Payment</h2>
      <p class="pp-copy">Explore vehicles tailored to your lifestyle and budget. We’ll connect you with a car that exceeds expectations.</p>
      <ul class="pp-list">
        <li>Affordable Payments</li>
        <li>Competitive Rates</li>
        <li>Comprehensive Coverage</li>
        <li>Canada-Wide Delivery</li>
      </ul>
      <div class="pp-image"><figure class="pp-frame" aria-label="Customer receiving keys" style="background-image:url('../images/pick%20a%20payment.png');"></figure></div>
      <div class="pp-cta"><a id="pp-start" class="pp-btn" href="#book-banner" data-tunnel-trigger="get-started">Get Started</a></div>
    </div>
  </section>

  <section class="reviews-block" id="clients-say" aria-label="What our clients say">
    <div class="label">WHAT OUR CLIENTS SAY</div>
    <div class="rv-head"><h2>What Our Clients Say</h2><span class="rv-underline" aria-hidden="true"></span></div>
    <div class="rv-grid" id="reviewsGrid"></div>
  </section>

  <section class="final-hero" id="final-hero" aria-label="Final hero">
    <div class="label">FINAL HERO</div>
    <div class="final-hero__inner">
      <div class="final-hero__copy">
        <h1 class="final-hero__title">FIND CARS ANY<br><span>BUDGET WILL LOVE</span></h1>
        <a href="#alfa-specials" class="approved" data-tunnel-trigger="get-started">Get Started</a>
      </div>
<div class="final-hero__image" role="img" aria-label="Dillon with Maserati"></div>
    </div>
  </section>

  <footer class="final-footer" id="contact-us" aria-label="Contact & links">
    <div class="label">FOOTER</div>
    <div class="final-footer__grid">
      <div class="final-footer__brand">
        <img src="https://i.imgur.com/1Z1Qd8d.png" alt="Maserati & Alfa Romeo of Winnipeg" class="brand-logo">
        <p class="brand-text">
          Maserati &amp; Alfa Romeo of Winnipeg — streamlined, customer-focused vehicle financing for a smooth experience.
        </p>
      </div>
      <nav class="final-footer__col">
        <h3>Quick Links</h3>
        <ul>
          <li><a href="#easy-steps">Easy steps</a></li>
          <li><a href="#about-ma-ar">About Us</a></li>
          <li><a href="#featured-vehicles">Featured Vehicles</a></li>
        </ul>
      </nav>
      <nav class="final-footer__col">
        <h3>Social Media</h3>
        <ul>
          <li><a href="https://facebook.com" target="_blank" rel="noopener">Facebook</a></li>
          <li><a href="https://instagram.com" target="_blank" rel="noopener">Instagram</a></li>
        </ul>
      </nav>
     <div class="final-footer__col final-footer__contact">
  <button class="footer-contact-btn" id="footerContactBtn">Contact Us</button>
</div>


    </div>
  </footer>



  <!-- keep exactly ONE canvas + toast -->
   <!-- REFER A FRIEND MODAL -->
<div class="modal-backdrop" id="referModal" aria-hidden="true" role="dialog" aria-modal="true" aria-label="Refer a friend">
  <div class="modal" role="document">
    <header>
      <h3>Refer a Friend — Quick Kickback</h3>
      <button class="close" aria-label="Close" id="referClose">×</button>
    </header>
    <div class="tunnel" style="grid-template-columns:1fr;">
      <main>
        <form id="referForm">
          <div class="field">
            <label for="rfYourName">Your Full Name</label>
            <input id="rfYourName" type="text" placeholder="Jane Doe" autocomplete="name" required>
          </div>
          <div class="field">
            <label for="rfYourPhone">Your Phone</label>
            <input id="rfYourPhone" type="tel" placeholder="(204) 555-1234" autocomplete="tel" required>
          </div>

          <div class="rule" style="height:1px;width:100%;background:rgba(255,255,255,.16);margin:.4rem 0 1rem"></div>

          <div class="field">
            <label for="rfFriendName">Friend’s Full Name</label>
            <input id="rfFriendName" type="text" placeholder="Alex Smith" required>
          </div>
          <div class="field">
            <label for="rfFriendPhone">Friend’s Phone</label>
            <input id="rfFriendPhone" type="tel" placeholder="(204) 555-9876" required>
          </div>

          <div class="actions" style="margin-top:14px">
            <button class="btn outline" type="button" id="referCloseBtn2" onclick="document.getElementById('referClose').click()">Cancel</button>
            <button class="btn" id="referSubmit" type="submit" disabled>Send Referral</button>
          </div>

          <small class="Winter-footnote">We’ll confirm details and reach out. You’ll get your kickback after your friend purchases.</small>
        </form>
      </main>
    </div>
  </div>
</div>

  <canvas class="confetti" id="confetti"></canvas>
  <div class="toast" id="toast">Copied!</div>

  <!-- JS (leave as-is; we’ll update the script next) -->
  <script src="../javascript/auto.js"></script>
  <script>
/* Wire Claim Now → Winter tunnel */
document.addEventListener('click', (e) => {
  const btn = e.target.closest('#claimNowBtn');
  if (!btn) return;
  e.preventDefault();

  // If your Winter script exposes an opener, use it
  if (typeof window.openModal === 'function') { window.openModal(); return; }
  if (typeof window.openWinterModal === 'function') { window.openWinterModal(); return; }

  // Fallback: simulate a click on the original Winter opener
  document.getElementById('openWinterModalBtn')?.click();
}, true);
</script>


  <!-- ================= CONTACT US TUNNEL (separate) ================= -->
  <div id="contactTunnel" class="ct-overlay" aria-hidden="true" role="dialog" aria-modal="true" aria-label="Contact Us">
    <div class="ct-modal" role="document">
      <button id="ctClose" class="ct-x" aria-label="Close">×</button>

      <!-- Step 1: Intro + Request A Call -->
      <section id="ctStep1" class="ct-panel active" aria-labelledby="ctStep1Title">
        <header class="ct-header">
          <h3 id="ctStep1Title">Contact your favourite associate</h3>
          <p><strong>Jadon Dillon</strong> · <a href="tel:12045576877">204-557-6877</a></p>
        </header>

        <div class="ct-body">
          <p class="ct-sub">Tap below and we’ll call you back.</p>
          <button id="ctReqCall" class="btn btn-primary">Request a Call</button>
        </div>

        <footer class="ct-footer">
          <small>Address: 1717 Waverly Street #500, Winnipeg</small>
        </footer>
      </section>

      <!-- Step 2: Full name -->
      <section id="ctStep2" class="ct-panel" aria-labelledby="ctStep2Title">
        <h3 id="ctStep2Title">What’s your full name?</h3>
        <div class="ct-field">
          <label for="ctName">Full name</label>
          <input id="ctName" type="text" placeholder="e.g., Jane Smith" autocomplete="name" />
        </div>
        <div class="ct-actions">
          <button id="ctTo3" class="btn btn-primary" disabled>Continue</button>
        </div>
        <footer class="ct-footer">
          <small>Address: 1717 Waverly Street #500, Winnipeg</small>
        </footer>
      </section>

      <!-- Step 3: Phone -->
      <section id="ctStep3" class="ct-panel" aria-labelledby="ctStep3Title">
        <h3 id="ctStep3Title">What’s the best number to reach you?</h3>
        <div class="ct-field">
          <label for="ctPhone">Phone number</label>
          <input id="ctPhone" type="tel" inputmode="tel" placeholder="(204) 555-1234" autocomplete="tel" />
        </div>
        <div class="ct-actions">
          <button id="ctTo4" class="btn btn-primary" disabled>Continue</button>
        </div>
        <footer class="ct-footer">
          <small>Address: 1717 Waverly Street #500, Winnipeg</small>
        </footer>
      </section>

      <!-- Step 4: Preferred time -->
      <section id="ctStep4" class="ct-panel" aria-labelledby="ctStep4Title">
        <h3 id="ctStep4Title">Preferred time for a call</h3>
        <fieldset id="ctTimes" class="ct-times">
          <label class="ct-radio"><input type="radio" name="ctTime" value="Morning"> Morning</label>
          <label class="ct-radio"><input type="radio" name="ctTime" value="Noon"> Noon</label>
          <label class="ct-radio"><input type="radio" name="ctTime" value="Evening"> Evening</label>
        </fieldset>
        <div class="ct-actions">
          <button id="ctSubmit" class="btn btn-primary" disabled>Confirm</button>
        </div>
        <footer class="ct-footer">
          <small>Address: 1717 Waverly Street #500, Winnipeg</small>
        </footer>
      </section>

      <!-- Step 5: Done -->
      <section id="ctStep5" class="ct-panel" aria-labelledby="ctStep5Title">
        <h3 id="ctStep5Title">All set — we’ll call you shortly</h3>
        <p>Thanks! Your request has been received.</p>
        <div class="ct-actions">
          <button id="ctDone" class="btn">Close</button>
        </div>
        <footer class="ct-footer">
          <small>Address: 1717 Waverly Street #500, Winnipeg</small>
        </footer>
      </section>
    </div>
  </div>
  
<!-- OFFER_TUNNEL_PATCH v2.4 — Full updated batch with Step-1 rules:
     • Shop / Schedule / Book / Best Deal → Vehicle Type picker (bright)
     • Get Trade-In Offer → No vehicle card, big flashy banner “Get top $…”
     • Bright calendar + time slots + bright type tiles
     Paste at the very end of your JS bundle (replace older OFFER_TUNNEL_PATCH). -->
<script>
function bindPhone(input, onValidity){
  if (!input) return;

  const format = v => (window.formatNaPhone ? window.formatNaPhone(v) : fmtPhone(v));

  const caretFromDigitIndex = (formatted, digitIndex) => {
    if (digitIndex <= 0) return 0;
    let seen = 0;
    for (let i = 0; i < formatted.length; i++) {
      if (//d/.test(formatted[i])) {
        seen++;
        if (seen === digitIndex) return i + 1;
      }
    }
    return formatted.length;
  };

  const update = () => {
    const raw   = input.value || '';
    const caret = input.selectionStart ?? raw.length;
    const digitIndexBefore = raw.slice(0, caret).replace(//D/g, '').length;

    let d = raw.replace(//D/g, '');
    if (d.length > 10 && d[0] === '1') d = d.slice(1);
    d = d.slice(0, 10);

    const next = format(d);
    input.value = next;

    const pos = caretFromDigitIndex(next, digitIndexBefore);
    try { input.setSelectionRange(pos, pos); } catch (_) {}

    const ok = d.length >= 10;
    input.setAttribute('aria-invalid', ok ? 'false' : 'true');
    onValidity?.(ok);
  };

  input.addEventListener('input', update);
  input.addEventListener('blur',  update);
  update();
}

 
  const confetti = ()=> window.popConfetti?.();

  /* ========= CSS (bright type tiles + bright scheduler + trade banner) ========= */
  const style = document.createElement('style');
  style.textContent = `
  .uot-overlay{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(3,7,18,.70);backdrop-filter:blur(6px);z-index:10050;padding:16px}
  .uot-overlay[aria-hidden="false"]{display:flex}
  .uot-modal{width:min(860px,96vw);border-radius:20px;border:1px solid rgba(255,255,255,.18);background:#0B0F14;color:#EAF2FF;box-shadow:0 30px 80px rgba(0,0,0,.5);overflow:hidden}
  .uot-header{display:flex;align-items:center;justify-content:space-between;padding:14px 16px;border-bottom:1px solid rgba(255,255,255,.16)}
  .uot-title{margin:0;font-size:18px;font-weight:800}
  .uot-close{background:transparent;border:0;color:#EAF2FF;font-size:20px;cursor:pointer}
  .uot-shell{display:grid;grid-template-columns:260px 1fr;min-height:460px}
  @media (max-width:800px){.uot-shell{grid-template-columns:1fr}}
  .uot-aside{background:radial-gradient(800px 400px at 0% 0%, rgba(194,38,54,.14), transparent), #0E141B;padding:16px;border-right:1px solid rgba(255,255,255,.12)}
  .uot-steps{list-style:none;margin:0;padding:0;display:grid;gap:8px}
  .uot-steps li{display:flex;gap:10px;align-items:center;font-weight:800;font-size:14px;opacity:.7}
  .uot-steps li.active{opacity:1}
  .uot-steps .dot{width:10px;height:10px;border-radius:999px;background:#243447;border:1px solid rgba(255,255,255,.24)}
  .uot-steps li.active .dot{background:linear-gradient(90deg,var(--alfa-red,#C22636),var(--alfa-red-2,#971B29));border-color:transparent;box-shadow:0 0 0 3px rgba(194,38,54,.25)}
  .uot-main{background:#0B0F14;padding:16px}
  .uot-panel{display:none}.uot-panel.active{display:block}
  .uot-h{margin:.1rem 0 .6rem;font-size:18px}.uot-sub{margin:.2rem 0 .8rem;color:#BBD0FF}
  .uot-actions{display:flex;gap:10px;justify-content:flex-end;margin-top:8px}
  .uot-actions-split{justify-content:space-between;position:sticky;bottom:0;background:linear-gradient(180deg, rgba(11,15,20,.0), rgba(11,15,20,.75) 40%);padding-top:8px}
  .uot-next,.uot-back,.uot-btn,.uot-outline{appearance:none;border:0;cursor:pointer;padding:12px 16px;border-radius:12px;font-weight:900;letter-spacing:.04em;font-size:14px;background:linear-gradient(90deg,var(--alfa-red,#C22636),var(--alfa-red-2,#971B29));color:#fff;box-shadow:0 14px 36px rgba(194,38,54,.38)}
  .uot-outline{background:transparent;border:1px solid rgba(255,255,255,.22)}
  .uot-next[disabled]{opacity:.5;filter:grayscale(1);cursor:not-allowed}

  /* Step 1 — legacy “offer card” container */
  .uot-offer{display:grid;gap:10px}
  .uot-lead{margin:0 0 2px}
  .uot-vehicle{display:grid;grid-template-columns:110px 1fr;gap:12px;border:1px solid rgba(255,255,255,.16);border-radius:12px;padding:10px;background:rgba(255,255,255,.04)}
  .uot-veh-media{width:100%;aspect-ratio:16/10;overflow:hidden;border-radius:10px;background:#111}
  .uot-veh-media img{width:100%;height:100%;object-fit:cover;display:block}
  .uot-veh-title{margin:.1rem 0 .3rem;font-size:15px;font-weight:800}
  .uot-tag{display:inline-block;border:1px solid rgba(255,255,255,.22);border-radius:999px;padding:4px 8px;font-size:12px;margin-right:6px}
  .uot-veh-pricing{font-weight:900}.uot-price{margin-right:10px}

  /* Step 1 — TYPE PICKER (BRIGHT) */
  .uot-type{display:none}
  .uot-type.active{display:block}
  .uot-type .note{color:#475569;font-size:12px;margin-top:8px}
  .uot-type-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:12px}
  @media (max-width:720px){.uot-type-grid{grid-template-columns:repeat(2,1fr)}}
  .uot-tile{
    border:1px solid #e6eaf2;border-radius:14px;overflow:hidden;background:#ffffff;
    cursor:pointer;display:grid;grid-template-rows:auto 44px;transition:.14s ease;
    box-shadow:0 8px 18px rgba(0,0,0,.08);
  }
  .uot-tile:hover{transform:translateY(-1px);box-shadow:0 10px 22px rgba(0,0,0,.12)}
  .uot-tile figure{margin:0;display:grid;place-items:center;height:120px;background:#f8fafc}
  .uot-tile img{width:86%;height:auto;object-fit:contain;filter:drop-shadow(0 2px 8px rgba(0,0,0,.08))}
  .uot-tile footer{display:grid;place-items:center;font-weight:900;background:#ffffff;color:#0b1220}
  .uot-tile.selected{outline:3px solid rgba(194,38,54,.28);box-shadow:0 16px 34px rgba(194,38,54,.22)}

  /* ===== Scheduler — SUPER BRIGHT ===== */
  .uot-scheduler{display:grid;grid-template-columns:1fr 1fr;gap:12px}
  @media (max-width:720px){.uot-scheduler{grid-template-columns:1fr}}
  .uot-cal,.uot-slots{
    background:#ffffff;color:#0b1220;
    border:1px solid #e6eaf2;border-radius:12px;padding:10px;
    box-shadow:0 8px 22px rgba(0,0,0,.12);
  }
  .uot-cal-head{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px;gap:8px}
  .uot-cal-grid{display:grid;grid-template-columns:repeat(7,1fr);gap:6px}
  .uot-dow,.uot-day{text-align:center;padding:8px 0;border-radius:8px;font-weight:800}
  .uot-dow{background:#f1f5ff;color:#1f2937;font-size:12px;border:1px solid #e6eaf2}
  .uot-day{background:#ffffff;color:#0b1220;border:1px solid #e6eaf2;cursor:pointer}
  .uot-day.other{opacity:.45}
  .uot-day.disabled{opacity:.45;cursor:not-allowed;background:#f5f6fb}
  .uot-day:not(.disabled):hover{background:#f8fafc}
  .uot-day.selected{outline:3px solid rgba(194,38,54,.25);background:#fff0f2}
  .uot-slots header{font-weight:900;margin-bottom:8px}
  .uot-slot-list{display:grid;grid-template-columns:repeat(2,1fr);gap:8px;align-content:start;max-height:240px;overflow:auto}
  @media (max-width:720px){.uot-slot-list{grid-template-columns:1fr}}
  .uot-slot{background:#ffffff;color:#0b1220;border:1px solid #e6eaf2;border-radius:8px;padding:10px;text-align:center;font-weight:900;cursor:pointer}
  .uot-slot.disabled{opacity:.45;cursor:not-allowed;background:#f5f6fb}
  .uot-slot:hover:not(.disabled){background:#f8fafc}
  .uot-slot.selected{outline:3px solid rgba(194,38,54,.25);background:#fff0f2}
  .uot-slot-empty{grid-column:1/-1;color:#475569}

  /* Step 1 — TRADE-IN FLASH BANNER */
  .uot-trade-banner{
    display:none;align-items:center;gap:14px;border-radius:14px;padding:14px 16px;
    background:linear-gradient(180deg,#ffe1e4,#fff5f6); color:#7a0f18;
    border:1px solid #ffd0d6; box-shadow:0 10px 26px rgba(194,38,54,.18), inset 0 -4px 0 rgba(194,38,54,.12);
    font-weight:900;
  }
  .uot-trade-banner.show{display:flex}
  .uot-trade-coin{
    width:44px;height:44px;border-radius:999px;display:grid;place-items:center;
    background:radial-gradient(circle at 30% 30%, #ff8aa0, #e9304a);
    color:#fff;font-size:22px;box-shadow:0 10px 22px rgba(233,48,74,.35);
    animation:coinpulse 1.6s ease-in-out infinite;
  }
  @keyframes coinpulse{0%,100%{transform:scale(1)}50%{transform:scale(1.08)}}

  /* Step 4 */
  .uot-generating{display:grid;gap:12px;align-items:center;justify-items:center;padding:20px;text-align:center}
  .uot-spinner{width:56px;height:56px;border-radius:50%;border:6px solid #e9efff;border-top-color:var(--alfa-red,#C22636);animation:uotspin 1s linear infinite}
  @keyframes uotspin{to{transform:rotate(360deg)}}
  .uot-codebox{margin-top:10px;padding:14px;border-radius:14px;border:1px dashed #3B82F6;background:#f5f9ff;color:#0b1220;display:grid;gap:8px;justify-items:center}
  .uot-code{font-family:ui-monospace,Menlo,Consolas,monospace;font-weight:900;letter-spacing:.18em;font-size:20px;color:#0b1220}
  .uot-footnote{font-size:12px;color:#3b4456}
  `;
  document.head.appendChild(style);

  /* ========= HTML structure ========= */
  const mount = document.createElement('div');
  mount.innerHTML = `
  <div id="offerTunnel" class="uot-overlay" aria-hidden="true" role="dialog" aria-modal="true" aria-label="Schedule appointment & claim Winter bonus">
    <div class="uot-modal" role="document">
      <header class="uot-header">
        <h3 class="uot-title">Schedule your in-person appointment & claim your Winter bonus</h3>
        <button class="uot-close" aria-label="Close">×</button>
      </header>
      <div class="uot-shell">
        <aside class="uot-aside">
          <ol class="uot-steps">
            <li class="active"><span class="dot" aria-hidden="true"></span> Offer</li>
            <li><span class="dot" aria-hidden="true"></span> Your Details</li>
            <li><span class="dot" aria-hidden="true"></span> Schedule</li>
            <li><span class="dot" aria-hidden="true"></span> Your Code</li>
          </ol>
        </aside>
        <main class="uot-main">
          <!-- STEP 1 -->
          <section class="uot-panel active" id="uotStep1">
            <!-- Offer/card mode (used only when not in type-picker nor trade banner) -->
            <div class="uot-offer" id="uotOfferMode">
              <h4 class="uot-h" id="uotStep1T">Great choice!</h4>
              <p id="uotHeadline" class="uot-lead">
                Let’s schedule your in-person appointment and <em>claim your bonus code</em>.
              </p>
              <div class="uot-source">Triggered from: <strong id="uotSourceLabel">Shop Now</strong></div>

              <!-- Trade-in flashy banner (hidden unless trade CTA) -->
              <div class="uot-trade-banner" id="uotTradeBanner" aria-live="polite">
                <div class="uot-trade-coin">$</div>
                <div>Get top $ for your trade & upgrade your ride</div>
              </div>

              <!-- Optional vehicle card (we will hide for Trade-In) -->
              <article class="uot-vehicle" id="uotVehCard" hidden>
                <div class="uot-veh-media"><img id="uotVehImg" src="" alt=""></div>
                <div class="uot-veh-body">
                  <h5 id="uotVehTitle" class="uot-veh-title">—</h5>
                  <div class="uot-veh-meta">
                    <span id="uotVehStock" class="uot-tag">Stock: —</span>
                    <span id="uotVehTrim"  class="uot-tag">Trim: —</span>
                  </div>
                  <div class="uot-veh-pricing">
                    <span id="uotVehPrice"    class="uot-price">—</span>
                    <small id="uotVehPayment" class="uot-pay">—</small>
                  </div>
                </div>
              </article>
            </div>

            <!-- TYPE PICKER mode -->
<div class="uot-type" id="uotTypeMode" hidden aria-describedby="uotTypeError">
  <h4 class="uot-h" style="margin-top:0">
    Select your desired vehicle type: <span aria-hidden="true">*</span>
  </h4>
  <div class="uot-type-grid">
    <button class="uot-tile" data-type="Truck">
      <figure><img src="/images/car-icons/pickup-truck-svgrepo-com.svg" alt="Truck"></figure>
      <footer>Truck</footer>
    </button>
    <button class="uot-tile" data-type="SUV">
      <figure><img src="/images/car-icons/suv-svgrepo-com.svg" alt="SUV"></figure>
      <footer>SUV</footer>
    </button>
    <button class="uot-tile" data-type="Minivan">
      <figure><img src="/images/car-icons/minivan_01.svg" alt="Minivan"></figure>
      <footer>Minivan</footer>
    </button>
    <button class="uot-tile" data-type="Car">
      <figure><img src="/images/car-icons/car real.svg" alt="Car"></figure>
      <footer>Car</footer>
    </button>
  </div>
</div>

          </section>

          <!-- STEP 2 -->
          <section class="uot-panel" id="uotStep2">
            <h4 class="uot-h">Your details</h4>
            <div class="uot-field">
              <label for="uotName">Full name</label>
              <input id="uotName" type="text" placeholder="e.g., Jane Smith" autocomplete="name">
            </div>
            <div class="uot-field">
              <label for="uotPhone">Phone</label>
              <input id="uotPhone" type="tel" placeholder="(204) 555-1234" autocomplete="tel">
            </div>
            <div class="uot-actions uot-actions-split">
              <button class="uot-back" data-to="1">Back</button>
              <button class="uot-next" data-to="3" id="uotTo3" disabled>Continue</button>
            </div>
          </section>

          <!-- STEP 3 -->
          <section class="uot-panel" id="uotStep3">
            <h4 class="uot-h">Pick a time</h4>
            <div class="uot-scheduler">
              <div class="uot-cal">
                <header class="uot-cal-head">
                  <button class="uot-btn uot-btn-sm" id="uotPrevMonth" aria-label="Previous month">‹</button>
                  <strong class="uot-cal-title" id="uotCalTitle">Month YYYY</strong>
                  <button class="uot-btn uot-btn-sm" id="uotNextMonth" aria-label="Next month">›</button>
                </header>
                <div class="uot-cal-grid" id="uotCalGrid"></div>
              </div>
              <div class="uot-slots">
                <header>Available times</header>
                <div class="uot-slot-list" id="uotSlotList"><div class="uot-slot-empty">Select a date to see times.</div></div>
              </div>
            </div>
            <div class="uot-actions uot-actions-split">
              <button class="uot-back" data-to="2">Back</button>
              <button class="uot-next" data-to="4" id="uotTo4" disabled>Continue</button>
            </div>
          </section>

          <!-- STEP 4 -->
          <section class="uot-panel" id="uotStep4">
            <h4 class="uot-h">Your Winter bonus code</h4>
            <div class="uot-generating" id="uotGenState">
              <div class="uot-spinner" aria-hidden="true"></div>
              <div><div class="uot-gen-title">Generating your Winter bonus…</div><div class="uot-gen-sub">Securing your code and perks now.</div></div>
            </div>
            <div class="uot-codebox" id="uotCodeBox" hidden>
              <div><strong>Your Winter Code:</strong></div>
              <div class="uot-code" id="uotFinalCode">Winter-XXXX-XXXX</div>
              <div class="uot-actions uot-actions-compact">
                <button class="uot-btn" id="uotCopy">Copy Code</button>
                <button class="uot-btn uot-outline" id="uotDone">Done</button>
              </div>
              <small class="uot-footnote">Show this code at delivery to redeem your perks.</small>
            </div>
          </section>
        </main>
      </div>
    </div>
  </div>`;
  document.body.appendChild(mount.firstElementChild);

  /* ========= wiring ========= */
  const modal = $('#offerTunnel');
  const steps = [$('#uotStep1'),$('#uotStep2'),$('#uotStep3'),$('#uotStep4')];
  const rail  = $$('.uot-steps li');

  function setStep(n){
    steps.forEach((p,i)=>p.classList.toggle('active',i===n-1));
    rail.forEach((r,i)=>r.classList.toggle('active',i===n-1));
    steps[n-1].querySelector('button,[href],input,textarea,select')?.focus();
  }
  function open(){ modal.setAttribute('aria-hidden','false'); document.body.style.overflow='hidden'; setStep(1); }
  function close(){ modal.setAttribute('aria-hidden','true'); document.body.style.overflow=''; }
  modal.addEventListener('click',e=>{ if(e.target===modal) close(); });
  $('.uot-close')?.addEventListener('click',close);
  window.addEventListener('keydown',e=>{ if(e.key==='Escape' && modal.getAttribute('aria-hidden')==='false') close(); });

  modal.addEventListener('click', (e)=>{
    const to = e.target.getAttribute?.('data-to'); if(!to) return;
    e.preventDefault();
    setStep(+to);
    if (+to===4) startGenerate();
  });

  /* ========= Step 1 modes ========= */
  const els = {
    source: $('#uotSourceLabel'),
    head  : $('#uotHeadline'),
    card  : $('#uotVehCard'),
    img   : $('#uotVehImg'),
    title : $('#uotVehTitle'),
    stock : $('#uotVehStock'),
    trim  : $('#uotVehTrim'),
    price : $('#uotVehPrice'),
    pay   : $('#uotVehPayment'),
    offer : $('#uotOfferMode'),
    typeWrap: $('#uotTypeMode'),
    typeError: $('#uotTypeError'),
    tradeBanner: $('#uotTradeBanner'),
    next1 : $('#uotStep1Next'),
  };
  const typeTiles = $$('#uotTypeMode .uot-tile');

  function normalizeCta(t=''){
    const s=t.toLowerCase();
    if (//b(best/s*deal)/b/.test(s)) return 'Get the Best Deal';
    if (/book|schedule/.test(s))     return 'Schedule Appointment';
    if (/trade/.test(s))             return 'Get Trade-In Offer';
    if (/shop/.test(s))              return 'Shop Now';
    if (/approved|apply|started/.test(s)) return 'Shop Now'; // treat like Shop flow
    return 'Shop Now';
  }
  function wantsTypePicker(cta){
    // Per request: Shop Now, Schedule Appointment, Book Appointment, Get the Best Deal → type grid
    return /(Shop Now|Schedule Appointment|Get the Best Deal)/i.test(cta);
  }

  const fromFvCard = el=>{
    const card=el.closest?.('.fv-card'); if(!card) return null;
    return {
      img:   card.querySelector('.fv-media img')?.src || '',
      vehicle: card.querySelector('.fv-title')?.textContent?.trim() || '',
      price: card.querySelector('.fv-sale')?.textContent?.replace(/SALE PRICE/i,'').trim() || '',
      payment: card.querySelector('.fv-left')?.firstChild?.textContent?.trim() || ''
    };
  };
  const fromDealCard = el=>{
    const card=el.closest?.('.deal-card'); if(!card) return null;
    const heading=card.querySelector('.deal-heading')?.textContent?.replace(//s+/g,' ').trim() || '';
    const rate=card.querySelector('.band-value.rate')?.textContent?.trim() || '';
    const cash=card.querySelector('.band-value.cash')?.textContent?.trim() || '';
    return { vehicle:heading, img:'', price:`${rate} + ${cash}`, payment:'' };
  };

  let selectedType=null;

  function showTypeMode(){
    els.offer.style.display='none';
    els.typeWrap.hidden=false;
    els.typeWrap.classList.add('active');
    els.tradeBanner.classList.remove('show');
    els.card.hidden = true;
    els.next1.disabled = true;
  }
  function showOfferMode(){
    els.offer.style.display='grid';
    els.typeWrap.hidden=true;
    els.typeWrap.classList.remove('active');
    els.typeError.style.display='none';
  }

  function populateFromTrigger(trigger){
    const ds=trigger.dataset||{};
    const fv=fromFvCard(trigger)||{}, dl=fromDealCard(trigger)||{};
    const cta=normalizeCta(ds.cta || trigger.getAttribute('aria-label') || trigger.textContent || '');
    els.source.textContent = cta;

    selectedType = null;
    typeTiles.forEach(t=>t.classList.remove('selected'));

    if (wantsTypePicker(cta)){
      // TYPE PICKER for Shop/Schedule/Best Deal
      showTypeMode();
      return;
    }

    // Otherwise: Treat as “offer” mode. Special case for Trade-In: banner, no vehicle card.
    showOfferMode();

    if (cta === 'Get Trade-In Offer'){
      els.head.innerHTML = `Let’s schedule your in-person appointment and <em>claim your bonus code</em>.`;
      els.tradeBanner.classList.add('show');
      els.card.hidden = true;           // hide vehicle block entirely
      els.next1.disabled = false;       // user can continue right away
      return;
    }

    // (Fallback: show vehicle if available)
    const vehicle = ds.vehicle || fv.vehicle || dl.vehicle || '';
    const img     = ds.img     || fv.img     || '';
    const stock   = ds.stock   || '';
    const trim    = ds.trim    || '';
    const price   = ds.price   || fv.price   || dl.price || '';
    const payment = ds.payment || fv.payment || '';

    if (vehicle){
      els.head.innerHTML = `Great choice — let’s schedule your in-person appointment and <em>claim your bonus code</em>.`;
      els.card.hidden=false; els.title.textContent=vehicle;
      if (img){ els.img.src=img; els.img.alt=vehicle; } else { els.img.removeAttribute('src'); els.img.alt=''; }
      els.stock.textContent = stock ? `Stock: ${stock}` : 'Stock: —';
      els.trim.textContent  = trim  ? `Trim: ${trim}`   : 'Trim: —';
      els.price.textContent = price || '—';
      els.pay.textContent   = payment || '';
    } else {
      els.card.hidden=true;
    }
    els.tradeBanner.classList.remove('show');
    els.next1.disabled = false;
  }

  // Tile selection
  typeTiles.forEach(tile=>{
    tile.addEventListener('click', ()=>{
      selectedType = tile.dataset.type || null;
      typeTiles.forEach(t=>t.classList.toggle('selected', t===tile));
      els.typeError.style.display = selectedType ? 'none' : 'block';
      els.next1.disabled = !selectedType;
    });
  });

  /* ========= Step 2 validation ========= */
  const uName = $('#uotName'), uPhone = $('#uotPhone'), btnTo3 = $('#uotTo3');
  bindPhone(uPhone, ok=>{ btnTo3.disabled = !(uName.value.trim().length>=2 && ok); });
  uName.addEventListener('input', ()=>{
    const ok = digits(uPhone.value)>=10 && uName.value.trim().length>=2;
    btnTo3.disabled = !ok;
  });

  /* ========= Step 3 calendar & slots ========= */
  const calTitle=$('#uotCalTitle'), calGrid=$('#uotCalGrid'), slotList=$('#uotSlotList');
  const prevBtn=$('#uotPrevMonth'), nextBtn=$('#uotNextMonth'), to4=$('#uotTo4');
  let cal=new Date(); cal.setDate(1); let selDate=null, selTime=null;

  function renderCalendar(){
    calGrid.innerHTML='';
    const m=cal.getMonth(), y=cal.getFullYear();
    calTitle.textContent = `${cal.toLocaleString('default',{month:'long'})} ${y}`;
    const first=new Date(y,m,1), start=(first.getDay()+7)%7, days=new Date(y,m+1,0).getDate(), total=Math.ceil((start+days)/7)*7;

    ['Sun','Mon','Tue','Wed','Thu','Fri','Sat'].forEach(d=>{
      const el=document.createElement('div'); el.className='uot-dow'; el.textContent=d; calGrid.appendChild(el);
    });

    for(let i=0;i<total;i++){
      const day=i-start+1, b=document.createElement('button'); b.type='button'; b.className='uot-day';
      if(day<=0||day>days){
        b.textContent=new Date(y,m,day).getDate(); b.classList.add('other'); b.disabled=true;
      } else {
        b.textContent=day;
        const d=new Date(y,m,day), today=new Date(); today.setHours(0,0,0,0); const dd=new Date(d); dd.setHours(0,0,0,0);
        if (d.getDay()===0){ b.classList.add('disabled'); b.disabled=true; }  // Sundays closed
        if (dd<today){ b.classList.add('disabled'); b.disabled=true; }
        if (selDate && dd.getTime()===selDate.getTime()) b.classList.add('selected');
        b.addEventListener('click', ()=>{
          selDate=dd; selTime=null; renderSlots();
          $$('.uot-day',calGrid).forEach(x=>x.classList.remove('selected')); b.classList.add('selected');
          to4.disabled=true;
        });
      }
      calGrid.appendChild(b);
    }
  }
  function renderSlots(){
    slotList.innerHTML='';
    if(!selDate){ const d=document.createElement('div'); d.className='uot-slot-empty'; d.textContent='Select a date to see times.'; slotList.appendChild(d); return; }
    const dow=selDate.getDay(); let start=9,end=18; if(dow===1){ start=12; end=21; } if(dow===0){ const d=document.createElement('div'); d.className='uot-slot-empty'; d.textContent='Closed on Sundays.'; slotList.appendChild(d); return; }
    const now=new Date(), isToday=(new Date().toDateString()===selDate.toDateString()), slots=[];
    for(let h=start;h<=end;h++){
      for(let m of [0,30]){
        if (h===end && m>0) continue;
        const t=new Date(selDate); t.setHours(h,m,0,0);
        if (isToday && t<now) continue;
        const label=`${((h+11)%12+1)}:${pad(m)} ${h<12?'AM':'PM'}`;
        slots.push({t,label});
      }
    }
    if(!slots.length){ const d=document.createElement('div'); d.className='uot-slot-empty'; d.textContent='No remaining times today. Choose another date.'; slotList.appendChild(d); return; }
    slots.forEach(({t,label})=>{
      const b=document.createElement('button'); b.type='button'; b.className='uot-slot'; b.textContent=label;
      b.addEventListener('click', ()=>{
        selTime=t; $$('.uot-slot',slotList).forEach(x=>x.classList.remove('selected')); b.classList.add('selected');
        to4.disabled=false;
      });
      slotList.appendChild(b);
    });
  }
  prevBtn.addEventListener('click', ()=>{ cal.setMonth(cal.getMonth()-1); renderCalendar(); });
  nextBtn.addEventListener('click', ()=>{ cal.setMonth(cal.getMonth()+1); renderCalendar(); });
  renderCalendar();

  /* ========= Step 4: code ========= */
  const genWrap=$('#uotGenState'), codeBox=$('#uotCodeBox'), finalCode=$('#uotFinalCode');
  function genCode(){ const chars='ABCDEFGHJKLMNPQRSTUVWXYZ23456789'; let a='',b=''; for(let i=0;i<4;i++) a+=chars[(Math.random()*chars.length)|0]; for(let i=0;i<4;i++) b+=chars[(Math.random()*chars.length)|0]; return `Winter-${a}-${b}`; }
  function startGenerate(){
    genWrap.hidden=false; codeBox.hidden=true;
    setTimeout(()=>{
      const code=genCode(); finalCode.textContent=code;
      try{ localStorage.setItem('uot_reserved_code',code);}catch(_){}
      genWrap.hidden=true; codeBox.hidden=false; confetti();
      try{
        const lead={ type:selectedType||null, when: (selDate && selTime) ? new Date(selTime).toISOString() : null, ts:new Date().toISOString() };
        localStorage.setItem('uot_lead_context', JSON.stringify(lead));
      }catch(_){}
    },800);
  }
  $('#uotCopy')?.addEventListener('click', async ()=>{
    try{ await navigator.clipboard.writeText(finalCode?.textContent?.trim()||''); toast('Winter code copied'); }catch(_){ toast('Could not copy'); }
  });
  $('#uotDone')?.addEventListener('click', close);
  const saved = localStorage.getItem('uot_reserved_code'); if(saved) finalCode.textContent=saved;

  /* ========= CTA patch: all relevant buttons open this flow ========= */
  function shouldOpen(el){
    if (!el) return false;
    if (el.closest('[data-open="offer"]')) return true;
    const href=(el.getAttribute?.('href')||'').toLowerCase(); if (href==='#offertunnel') return true;
    if (el.closest('.approved,.learn-more,.cta-ghost,.cta-red,.fv-btn.shop,.fv-btn.approve,.cta.primary,.cta.secondary')) return true;
    const txt=(el.textContent||'').trim().toLowerCase();
    return /(shop now|schedule|book|appointment|trade[-/s]?in|best deal|apply|approved|get started)/.test(txt);
  }
  document.addEventListener('click',(e)=>{
    const t=e.target.closest('a,button'); if(!t) return;
    if(!shouldOpen(t)) return;
    e.preventDefault(); e.stopPropagation();
    populateFromTrigger(t);
    open();
  }, true);

  window.openOfferTunnel = open;
})();

</script>



<!-- APPLICATION_TUNNEL v1.4 — unified (Step 7/11/12 fixes + CTA routing + Winter anti-hijack) -->
<!-- ========================= 1) OFFER / Winter TUNNEL (suppression-aware) ========================= -->
<script>
(function OFFER_TUNNEL_V26(){
  if (window.__offerTunnelInit) return; window.__offerTunnelInit = true;

  /* ---------- suppression helpers (shared with the App tunnel) ---------- */
  const SUPPRESS_KEY = 'Winter_suppress_until';
  function now(){ return Date.now(); }
  function WinterSuppressed(){
    try { const v = +localStorage.getItem(SUPPRESS_KEY) || 0; return now() < v; } catch(_) { return false; }
  }
  function onAppFinishedSuppress(ms=21600000){ // 6 hours by default
    try { localStorage.setItem(SUPPRESS_KEY, String(now()+ms)); } catch(_) {}
  }
  window.addEventListener('app_tunnel_finished', ()=>onAppFinishedSuppress());

  /* ---------- tiny helpers ---------- */
  const $  = (s,p=document)=>p.querySelector(s);
  const $$ = (s,p=document)=>[...p.querySelectorAll(s)];
  const pad = n=>String(n).padStart(2,'0');

  /* ---------- CSS (bright scheduler + type picker) ---------- */
  const style=document.createElement('style'); style.textContent=`
    .uot-overlay{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(3,7,18,.7);backdrop-filter:blur(6px);z-index:10050;padding:16px}
    .uot-overlay[aria-hidden="false"]{display:flex}
    .uot-modal{width:min(860px,96vw);border-radius:20px;border:1px solid rgba(255,255,255,.18);background:#0B0F14;color:#EAF2FF;box-shadow:0 30px 80px rgba(0,0,0,.5);overflow:hidden}
    .uot-header{display:flex;justify-content:space-between;align-items:center;padding:14px 16px;border-bottom:1px solid rgba(255,255,255,.16)}
    .uot-title{margin:0;font-size:18px;font-weight:800}
    .uot-close{background:transparent;border:0;color:#EAF2FF;font-size:20px;cursor:pointer}
    .uot-shell{display:grid;grid-template-columns:260px 1fr;min-height:460px}
    @media (max-width:800px){.uot-shell{grid-template-columns:1fr}}
    .uot-aside{background:radial-gradient(800px 400px at 0% 0%, rgba(194,38,54,.14), transparent), #0E141B;padding:16px;border-right:1px solid rgba(255,255,255,.12)}
    .uot-steps{list-style:none;margin:0;padding:0;display:grid;gap:8px}
    .uot-steps li{display:flex;gap:10px;align-items:center;font-weight:800;font-size:14px;opacity:.7}
    .uot-steps li.active{opacity:1}
    .uot-steps .dot{width:10px;height:10px;border-radius:999px;background:#243447;border:1px solid rgba(255,255,255,.24)}
    .uot-steps li.active .dot{background:linear-gradient(90deg,#C22636,#971B29);border-color:transparent;box-shadow:0 0 0 3px rgba(194,38,54,.25)}
    .uot-main{background:#0B0F14;padding:16px}
    .uot-panel{display:none}.uot-panel.active{display:block}
    .uot-actions{display:flex;gap:10px;justify-content:flex-end;margin-top:8px}
    .uot-actions-split{justify-content:space-between;position:sticky;bottom:0;background:linear-gradient(180deg,rgba(11,15,20,0),rgba(11,15,20,.75) 40%);padding-top:8px}
    .uot-next,.uot-back,.uot-btn,.uot-outline{appearance:none;border:0;cursor:pointer;padding:12px 16px;border-radius:12px;font-weight:900;letter-spacing:.04em;font-size:14px;background:linear-gradient(90deg,#C22636,#971B29);color:#fff;box-shadow:0 14px 36px rgba(194,38,54,.38)}
    .uot-outline{background:transparent;border:1px solid rgba(255,255,255,.22)}
    .uot-next[disabled]{opacity:.5;filter:grayscale(1);cursor:not-allowed}
    /* type grid */
    .uot-type-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:12px}
    @media (max-width:720px){.uot-type-grid{grid-template-columns:repeat(2,1fr)}}
    .uot-tile{border:1px solid #e6eaf2;border-radius:14px;overflow:hidden;background:#fff;cursor:pointer;display:grid;grid-template-rows:auto 44px;box-shadow:0 8px 18px rgba(0,0,0,.08)}
    .uot-tile figure{margin:0;display:grid;place-items:center;height:120px;background:#f8fafc}
    .uot-tile footer{display:grid;place-items:center;font-weight:900;color:#0b1220}
    .uot-tile.selected{outline:3px solid rgba(194,38,54,.28);box-shadow:0 16px 34px rgba(194,38,54,.22)}
    /* calendar */
    .uot-scheduler{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    @media (max-width:720px){.uot-scheduler{grid-template-columns:1fr}}
    .uot-cal,.uot-slots{background:#fff;color:#0b1220;border:1px solid #e6eaf2;border-radius:12px;padding:10px;box-shadow:0 8px 22px rgba(0,0,0,.12)}
    .uot-cal-head{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px;gap:8px}
    .uot-cal-grid{display:grid;grid-template-columns:repeat(7,1fr);gap:6px}
    .uot-dow,.uot-day{text-align:center;padding:8px 0;border-radius:8px;font-weight:800}
    .uot-dow{background:#f1f5ff;color:#1f2937;border:1px solid #e6eaf2;font-size:12px}
    .uot-day{background:#fff;border:1px solid #e6eaf2}
    .uot-day.other,.uot-day.disabled{opacity:.45}
    .uot-day.selected{outline:3px solid rgba(194,38,54,.25);background:#fff0f2}
    .uot-slot-list{display:grid;grid-template-columns:repeat(2,1fr);gap:8px;max-height:240px;overflow:auto}
    @media (max-width:720px){.uot-slot-list{grid-template-columns:1fr}}
    .uot-slot{background:#fff;border:1px solid #e6eaf2;border-radius:8px;padding:10px;text-align:center;font-weight:900;cursor:pointer}
    .uot-slot.selected{outline:3px solid rgba(194,38,54,.25);background:#fff0f2}
    .uot-slot-empty{grid-column:1/-1;color:#475569}
    .uot-codebox{margin-top:10px;padding:14px;border-radius:14px;border:1px dashed #3B82F6;background:#f5f9ff;color:#0b1220;display:grid;gap:8px;justify-items:center}
    .uot-code{font-family:ui-monospace,Menlo,Consolas,monospace;font-weight:900;letter-spacing:.18em;font-size:20px;color:#0b1220}
  `; document.head.appendChild(style);

  /* ---------- HTML shell (modal) ---------- */
  const shell=document.createElement('div');
  shell.innerHTML = `
  <div id="offerTunnel" class="uot-overlay" aria-
  hidden="true" role="dialog" aria-modal="true" aria-label="Schedule appointment & claim Winter bonus">
    <div class="uot-modal" role="document">
      <header class="uot-header">
        <h3 class="uot-title">Schedule your in-person appointment &amp; claim your Winter bonus</h3>
        <button class="uot-close" aria-label="Close">×</button>
      </header>
      <div class="uot-shell">
        <aside class="uot-aside"><ol class="uot-steps"><li class="active"><span class="dot"></span> Offer</li><li><span class="dot"></span> Your Details</li><li><span class="dot"></span> Schedule</li><li><span class="dot"></span> Your Code</li></ol></aside>
        <main class="uot-main">
          <!-- 1 -->
          <section class="uot-panel active" id="uotStep1">
            <div class="uot-type" id="uotTypeMode">
              <h4 class="uot-h" style="margin-top:0">Select your desired vehicle type: <span aria-hidden="true">*</span></h4>
              <div class="uot-type-grid">
                <button class="uot-tile" data-type="Truck"><figure><img src="/images/car-icons/pickup-truck-svgrepo-com.svg" alt="Truck"></figure><footer>Truck</footer></button>
                <button class="uot-tile" data-type="SUV"><figure><img src="/images/car-icons/suv-svgrepo-com.svg" alt="SUV"></figure><footer>SUV</footer></button>
                <button class="uot-tile" data-type="Minivan"><figure><img src="/images/car-icons/minivan_01.svg" alt="Minivan"></figure><footer>Minivan</footer></button>
                <button class="uot-tile" data-type="Car"><figure><img src="../images/car-icons/car real.svg" alt="Car"></figure><footer>Car</footer>
</button>
              </div>
              <div id="uotTypeError" class="note" style="display:none;color:#fca5a5;font-weight:700">Please choose a vehicle type.</div>
            </div>
            <div class="uot-actions"><button class="uot-next" data-to="2" id="uotStep1Next" disabled>Continue</button></div>
          </section>

          <!-- 2 -->
          <section class="uot-panel" id="uotStep2">
            <h4 class="uot-h">Your details</h4>
            <div class="uot-field"><label for="uotName">Full name</label><input id="uotName" type="text" placeholder="e.g., Jane Smith" autocomplete="name"></div>
            <div class="uot-field"><label for="uotPhone">Phone</label><input id="uotPhone" type="tel" placeholder="(204) 555-1234" autocomplete="tel"></div>
            <div class="uot-actions uot-actions-split"><button class="uot-back" data-to="1">Back</button><button class="uot-next" data-to="3" id="uotTo3" disabled>Continue</button></div>
          </section>

          <!-- 3 -->
          <section class="uot-panel" id="uotStep3">
            <h4 class="uot-h">Pick a time</h4>
            <div class="uot-scheduler">
              <div class="uot-cal">
                <header class="uot-cal-head"><button class="uot-btn" id="uotPrevMonth">‹</button><strong id="uotCalTitle">Month YYYY</strong><button class="uot-btn" id="uotNextMonth">›</button></header>
                <div class="uot-cal-grid" id="uotCalGrid"></div>
              </div>
              <div class="uot-slots"><header>Available times</header><div class="uot-slot-list" id="uotSlotList"><div class="uot-slot-empty">Select a date to see times.</div></div></div>
            </div>
            <div class="uot-actions uot-actions-split"><button class="uot-back" data-to="2">Back</button><button class="uot-next" data-to="4" id="uotTo4" disabled>Continue</button></div>
          </section>

          <!-- 4 -->
          <section class="uot-panel" id="uotStep4">
            <h4 class="uot-h">Your Winter bonus code</h4>
            <div class="uot-codebox" id="uotCodeBox"><div><strong>Your Winter Code:</strong></div><div class="uot-code" id="uotFinalCode">Winter-XXXX-XXXX</div>
              <div class="uot-actions"><button class="uot-btn" id="uotCopy">Copy Code</button><button class="uot-btn uot-outline" id="uotDone">Done</button></div>
              <small class="uot-footnote">Show this code at delivery to redeem your perks.</small>
            </div>
          </section>
        </main>
      </div>
    </div>
  </div>`; document.body.appendChild(shell.firstElementChild);

  /* ---------- wiring ---------- */
  const modal=$('#offerTunnel'); const steps=[$('#uotStep1'),$('#uotStep2'),$('#uotStep3'),$('#uotStep4')]; const rail=$$('.uot-steps li');
  function setStep(n){ steps.forEach((p,i)=>p.classList.toggle('active',i===n-1)); rail.forEach((r,i)=>r.classList.toggle('active',i===n-1)); }
  function open(){ if(WinterSuppressed()) return; modal.setAttribute('aria-hidden','false'); document.body.style.overflow='hidden'; setStep(1); }
  function close(){ modal.setAttribute('aria-hidden','true'); document.body.style.overflow=''; }
  modal.addEventListener('click',e=>{ if(e.target===modal) close(); });
  $('.uot-close')?.addEventListener('click',close);
  window.addEventListener('keydown',e=>{ if(e.key==='Escape'&&modal.getAttribute('aria-hidden')==='false') close(); });

  // Step 1 — type picker
  let selectedType=null; const tiles=$$('#uotTypeMode .uot-tile'), next1=$('#uotStep1Next'); tiles.forEach(t=>t.addEventListener('click',()=>{ selectedType=t.dataset.type||null; tiles.forEach(x=>x.classList.toggle('selected',x===t)); $('#uotTypeError').style.display=selectedType?'none':'block'; next1.disabled=!selectedType; }));
  modal.addEventListener('click',e=>{ const to=e.target.getAttribute?.('data-to'); if(!to) return; e.preventDefault(); setStep(+to); });

  // Step 2 validation
  const nameEl=$('#uotName'), phoneEl=$('#uotPhone'), btnTo3=$('#uotTo3');
  function onlyDigits(v){ return (v||'').replace(//D/g,''); }
  function maskPhoneInput(el){ const d=onlyDigits(el.value).slice(0,10); if(!d){ el.value=''; return; } el.value = d.length<4?`(${d}`:d.length<7?`(${d.slice(0,3)}) ${d.slice(3)}`:`(${d.slice(0,3)}) ${d.slice(3,6)}-${d.slice(6)}`; }
  function recheck2(){ btnTo3.disabled = !(nameEl.value.trim().length>=2 && onlyDigits(phoneEl.value).length===10); }
  phoneEl.addEventListener('input',()=>{ maskPhoneInput(phoneEl); recheck2(); }); nameEl.addEventListener('input',recheck2);

  // Step 3 calendar + slots
  const calTitle=$('#uotCalTitle'), calGrid=$('#uotCalGrid'), slotList=$('#uotSlotList'); const prev=$('#uotPrevMonth'), next=$('#uotNextMonth'), to4=$('#uotTo4');
  let cal=new Date(); cal.setDate(1); let selDate=null, selTime=null;
  function renderCalendar(){
    calGrid.innerHTML=''; const m=cal.getMonth(), y=cal.getFullYear(); calTitle.textContent=`${cal.toLocaleString('default',{month:'long'})} ${y}`;
    const first=new Date(y,m,1), start=(first.getDay()+7)%7, days=new Date(y,m+1,0).getDate(), total=Math.ceil((start+days)/7)*7;
    ['Sun','Mon','Tue','Wed','Thu','Fri','Sat'].forEach(d=>{ const el=document.createElement('div'); el.className='uot-dow'; el.textContent=d; calGrid.appendChild(el); });
    for(let i=0;i<total;i++){ const day=i-start+1; const b=document.createElement('button'); b.type='button'; b.className='uot-day';
      if(day<=0||day>days){ b.textContent=new Date(y,m,day).getDate(); b.classList.add('other'); b.disabled=true; }
      else { b.textContent=day; const d=new Date(y,m,day); const today=new Date(); today.setHours(0,0,0,0); const dd=new Date(d); dd.setHours(0,0,0,0);
        if(dd<today || d.getDay()===0){ b.classList.add('disabled'); b.disabled=true; }
        if(selDate && dd.getTime()===selDate.getTime()) b.classList.add('selected');
        b.addEventListener('click',()=>{ selDate=dd; selTime=null; renderSlots(); $$('.uot-day',calGrid).forEach(x=>x.classList.remove('selected')); b.classList.add('selected'); to4.disabled=true; });
      }
      calGrid.appendChild(b);
    }
  }
  function renderSlots(){
    slotList.innerHTML=''; if(!selDate){ slotList.innerHTML='<div class="uot-slot-empty">Select a date to see times.</div>'; return; }
    const nowd=new Date(), isToday=(nowd.toDateString()===selDate.toDateString()); const slots=[];
    for(let h=9;h<=18;h++){ for(let m of [0,30]){ if(h===18&&m>0) continue; const t=new Date(selDate); t.setHours(h,m,0,0); if(isToday && t<nowd) continue; const label=`${((h+11)%12+1)}:${pad(m)} ${h<12?'AM':'PM'}`; slots.push({t,label}); } }
    if(!slots.length){ slotList.innerHTML='<div class="uot-slot-empty">No remaining times today. Choose another date.</div>'; return; }
    slots.forEach(({t,label})=>{ const b=document.createElement('button'); b.type='button'; b.className='uot-slot'; b.textContent=label; b.addEventListener('click',()=>{ selTime=t; $$('.uot-slot',slotList).forEach(x=>x.classList.remove('selected')); b.classList.add('selected'); to4.disabled=false; }); slotList.appendChild(b); });
  }
  prev.addEventListener('click',()=>{ cal.setMonth(cal.getMonth()-1); renderCalendar(); }); next.addEventListener('click',()=>{ cal.setMonth(cal.getMonth()+1); renderCalendar(); }); renderCalendar();

  // Step 4: code
  const finalCode=$('#uotFinalCode'); function genCode(){ const C='ABCDEFGHJKLMNPQRSTUVWXYZ23456789'; const s=n=>Array.from({length:n},()=>C[(Math.random()*C.length)|0]).join(''); return `Winter-${s(4)}-${s(4)}`; }
  $('#uotCopy').addEventListener('click',async()=>{ try{ await navigator.clipboard.writeText(finalCode.textContent.trim()); }catch(_){ } });
  $('#uotDone').addEventListener('click',close);

  // Move to step 4 = generate code
  modal.addEventListener('click',e=>{ if(e.target.id==='uotTo4'){ finalCode.textContent = genCode(); try{ localStorage.setItem('uot_reserved_code', finalCode.textContent); }catch(_){} } });

  /* ---------- public openers (all suppression-aware) ---------- */
  function shouldOpen(el){
    if(!el) return false;
    const txt=(el.textContent||'').trim().toLowerCase();
    // Shop / Schedule / Book / Best Deal / Trade-In → offer tunnel
    return /(shop now|schedule|book|appointment|trade[-/s]?in|best deal)/.test(txt);
  }
  document.addEventListener('click',(e)=>{
    const t=e.target.closest('a,button'); if(!t) return;
    if(!shouldOpen(t)) return;
    if(WinterSuppressed()) return; // suppression guard
    e.preventDefault(); e.stopPropagation();
    open();
  }, true);

  // Expose & wrap legacy openers
  window.openOfferTunnel = function(){ if(!WinterSuppressed()) open(); };
  ['openWinterModal','openModal','showWinterBonus','openWinter','WinterOpen'].forEach(fn=>{
    if(typeof window[fn]==='function'){
      const orig=window[fn]; window[fn]=function(){ if(WinterSuppressed()) return; return orig.apply(this,arguments); };
    }else{
      // define safe no-ops to prevent other scripts from defining them later
      Object.defineProperty(window, fn, { configurable:true, writable:true, value:function(){ if(WinterSuppressed()) return; open(); }});
    }
  });

  // Hash guard (block #offertunnel opens while suppressed)
  window.addEventListener('hashchange',()=>{ if(location.hash.toLowerCase()==='#offertunnel' && WinterSuppressed()){ history.replaceState(null,'',location.pathname+location.search); }});
})();
</script>

<script>
/* ==================== APPLICATION TUNNEL — V18 (relaxed phone rule) ==================== */
(function APPLICATION_TUNNEL_V18(){
  if (window.__appTunnelInit) return; window.__appTunnelInit = true;

  /* ---------- helpers ---------- */
  const $  = (s,p=document)=>p.querySelector(s);
  const $$ = (s,p=document)=>[...p.querySelectorAll(s)];
  const emailOk = v=>/^[^/s@]+@[^/s@]+/.[^/s@]+$/.test((v||'').trim());
  const digits = v => String(v||'').replace(//D/g,'');
  const phoneMask = v=>{
    const d = digits(v).replace(/^1/,'').slice(0,10);
    if(!d) return '';
    if(d.length<=3) return d;
    if(d.length<=6) return `(${d.slice(0,3)}) ${d.slice(3)}`;
    return `(${d.slice(0,3)}) ${d.slice(3,6)}-${d.slice(6)}`;
  };
  const ls = {
    get(k,def=null){ try{const v=localStorage.getItem(k); return v?JSON.parse(v):def;}catch(_){return def;} },
    set(k,v){ try{localStorage.setItem(k,JSON.stringify(v));}catch(_){} }
  };

  // suppression key (shared with Offer tunnel)
  const SUPPRESS_KEY='Winter_suppress_until';
  function suppressWinter(ms=21600000){ try{ localStorage.setItem(SUPPRESS_KEY, String(Date.now()+ms)); }catch(_){} }

  /* ---------- CSS ---------- */
  const css=document.createElement('style'); css.textContent=`
    :root{--appx-accent:#C22636;--appx-accent2:#971B29;--appx-ring:#e6eaf2;--appx-ink:#0b1220}
    .appx-overlay{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(9,16,28,.72);backdrop-filter:blur(8px);z-index:10080;padding:16px}
    .appx-overlay[aria-hidden="false"]{display:flex}
    .appx-modal{width:min(920px,96vw);background:#fff;color:var(--appx-ink);border-radius:20px;box-shadow:0 30px 80px rgba(0,0,0,.45);overflow:hidden;border:1px solid var(--appx-ring)}
    .appx-head{position:sticky;top:0;background:#101826;color:#EAF2FF;padding:14px 16px;display:grid;grid-template-columns:1fr auto;gap:12px;align-items:center;border-bottom:1px solid rgba(255,255,255,.14)}
    .appx-step{font-weight:900}.appx-meta{font-size:12px;opacity:.85}.appx-close{background:transparent;border:0;color:#EAF2FF;font-size:20px;cursor:pointer}
    .appx-progress{grid-column:1/-1;height:8px;border-radius:999px;background:rgba(255,255,255,.14);overflow:hidden}
    .appx-progress>i{display:block;height:100%;width:8%;background:linear-gradient(90deg,var(--appx-accent),var(--appx-accent2))}
    .appx-body{padding:16px;min-height:460px;display:grid;grid-template-rows:1fr auto}
    .appx-panel{display:none}.appx-panel.active{display:block}
    .appx-foot{position:sticky;bottom:0;display:flex;justify-content:space-between;gap:10px;padding-top:10px;background:linear-gradient(180deg,rgba(255,255,255,0),rgba(255,255,255,.88) 45%)}
    .appx-ghost,.appx-next{appearance:none;border-radius:12px;padding:12px 16px;font-weight:900;cursor:pointer}
    .appx-ghost{background:#fff;border:1px solid var(--appx-ring);color:#0b1220}
    .appx-next{background:linear-gradient(90deg,var(--appx-accent),var(--appx-accent2));color:#fff;border:0;box-shadow:0 12px 30px rgba(194,38,54,.28)}
    .appx-next[disabled]{opacity:.5;filter:grayscale(1);cursor:not-allowed}
    .appx-h{margin:0 0 6px;font-size:22px;font-weight:900}.appx-sub{margin:0 0 14px;color:#5a6a82;font-weight:700}
    .appx-field{display:grid;gap:6px;margin:10px 0 12px}.appx-row{display:grid;grid-template-columns:1fr 1fr;gap:10px}
    @media (max-width:720px){.appx-row{grid-template-columns:1fr}}
    .appx-input,.appx-select{width:100%;padding:12px;border-radius:12px;border:1px solid var(--appx-ring);background:#fff}
    .appx-err{margin-top:6px;color:#b42318;font-weight:800;font-size:13px;display:none}.appx-err.show{display:block}
    .appx-cards{display:grid;grid-template-columns:repeat(4,1fr);gap:12px}
    [data-step="11"]{display:none !important;}
    @keyframes fadeUp { from{opacity:0;transform:translateY(10px) scale(.98)} to{opacity:1;transform:translateY(0) scale(1)} }
    .step-12-animate{ animation: fadeUp .45s ease-out both; }
    .appx-summary{border:1px solid var(--appx-ring);border-radius:12px;padding:12px}
    .appx-summary dl{display:grid;grid-template-columns:180px 1fr;gap:8px 10px;margin:0}
    .appx-summary dt{font-weight:800}
    .appx-summary dd{margin:0}
  `; document.head.appendChild(css);

  /* ---------- HTML ---------- */
  const wrap=document.createElement('div');
  wrap.innerHTML = `
  <div id="appTunnel" class="appx-overlay" aria-hidden="true" role="dialog" aria-modal="true">
    <div class="appx-modal" role="document">
      <header class="appx-head">
        <div>
          <div class="appx-step" id="appxStepLabel">Step 1 of 12 • Vehicle Type</div>
          <div class="appx-meta">Secure & encrypted • Won’t affect your credit score • ~2–3 minutes</div>
        </div>
        <button class="appx-close" id="appxClose" aria-label="Close">×</button>
        <div class="appx-progress"><i id="appxBar"></i></div>
      </header>
      <div class="appx-body">
        <main id="appxPanels">
          <!-- 1 -->
          <section class="appx-panel active" data-step="1">
            <h3 class="appx-h">Complete your application in minutes</h3>
            <p class="appx-sub">Select desired vehicle type</p>
            <div class="appx-field">
              <label><strong>Select Your Desired Vehicle Type: *</strong></label>
              <div class="appx-cards" id="appxTypeCards">
                <button type="button" class="appx-card" data-val="Truck"><figure><img src="/images/car-icons/pickup-truck-svgrepo-com.svg" alt="Truck"></figure><footer>Truck</footer></button>
                <button type="button" class="appx-card" data-val="SUV"><figure><img src="/images/car-icons/suv-svgrepo-com.svg" alt="SUV"></figure><footer>SUV</footer></button>
                <button type="button" class="appx-card" data-val="Minivan"><figure><img src="/images/car-icons/minivan_01.svg" alt="Minivan"></figure><footer>Minivan</footer></button>
                <button type="button" class="appx-card" data-val="Car"><figure><img src="/images/car-icons/car real.svg" alt="Car"></figure><footer>Car</footer></button>
              </div>
              <div class="appx-err" id="err-type">Please choose a vehicle type.</div>
            </div>
          </section>

          <!-- 2 -->
          <section class="appx-panel" data-step="2">
            <h3 class="appx-h">How much can your budget allow?</h3>
            <div class="appx-field">
              <label for="appxBudget"><strong>Monthly Payment Budget *</strong></label>
              <select id="appxBudget" class="appx-select">
                <option value="">Select…</option>
                <option value="under_400">Under $400</option>
                <option value="401_550">$401–$550</option>
                <option value="551_700">$551–$700</option>
                <option value="701_plus">$701+</option>
              </select>
              <div class="appx-err" id="err-budget">Please choose a monthly budget.</div>
            </div>
          </section>

          <!-- 3 -->
          <section class="appx-panel" data-step="3">
            <h3 class="appx-h">Are you old enough to finance?</h3>
            <div class="appx-row">
              <div class="appx-field"><label>Day *</label><select id="dobDay" class="appx-select"></select></div>
              <div class="appx-field"><label>Month *</label><select id="dobMonth" class="appx-select"></select></div>
              <div class="appx-field"><label>Year *</label><select id="dobYear" class="appx-select"></select></div>
            </div>
            <div class="appx-err" id="err-dob">Please complete day, month, and year.</div>
          </section>

          <!-- 4 -->
          <section class="appx-panel" data-step="4">
            <h3 class="appx-h">What is your employment status?</h3>
            <div class="appx-field">
              <label for="appxEmp"><strong>Income Type *</strong></label>
              <select id="appxEmp" class="appx-select">
                <option value="">Select…</option>
                <option>Employed full-time</option><option>Employed part-time</option><option>Self-Employed</option>
                <option>Seasonal</option><option>Employment Insurance</option><option>Retired</option>
                <option>Disability</option><option>Student</option><option>Other</option>
              </select>
              <div class="appx-err" id="err-emp">Please choose your income type.</div>
            </div>
          </section>

          <!-- 5 -->
          <section class="appx-panel" data-step="5" style="text-align:center">
            <div style="display:grid;justify-items:center;gap:10px;padding:26px;border-radius:16px;border:1px solid var(--appx-ring);box-shadow:0 18px 48px rgba(194,38,54,.16)">
              <div style="width:64px;height:64px;border-radius:999px;background:linear-gradient(90deg,var(--appx-accent),var(--appx-accent2));color:#fff;display:grid;place-items:center;font-size:32px;box-shadow:0 14px 42px rgba(194,38,54,.28)">✓</div>
              <h3 class="appx-h">Amazing — you’re on the fast track 🎉</h3>
              <p>We can now match you with vehicles and payments that fit your situation.</p>
            </div>
          </section>

          <!-- 6 -->
          <section class="appx-panel" data-step="6">
            <h3 class="appx-h">What’s your full name?</h3>
            <div class="appx-row">
              <div class="appx-field"><label>First Name *</label><input id="firstName" class="appx-input" type="text" autocomplete="given-name"></div>
              <div class="appx-field"><label>Middle Name (optional)</label><input id="middleName" class="appx-input" type="text"></div>
            </div>
            <div class="appx-field"><label>Last Name *</label><input id="lastName" class="appx-input" type="text" autocomplete="family-name"></div>
            <div class="appx-err" id="err-name">Please enter your first/last name.</div>
          </section>

          <!-- 7 -->
          <section class="appx-panel" data-step="7">
            <h3 class="appx-h">How can we contact you?</h3>
            <div class="appx-field"><label>Email *</label><input id="email" class="appx-input" type="email" placeholder="you@email.com" autocomplete="email"></div>
            <div class="appx-row">
              <div class="appx-field"><label>Mobile Phone</label><input id="mobile" class="appx-input" type="tel" placeholder="(xxx) xxx-xxxx" autocomplete="tel"></div>
              <div class="appx-field"><label>Home Phone (optional)</label><input id="home" class="appx-input" type="tel" placeholder="(xxx) xxx-xxxx"></div>
            </div>
            <div class="appx-err" id="err-contact"></div>
          </section>

          <!-- 8 -->
          <section class="appx-panel" data-step="8">
            <h3 class="appx-h">What’s your mailing address?</h3>
            <div class="appx-field"><label>Address *</label><input id="addr1" class="appx-input" type="text"></div>
            <div class="appx-field"><label>Address 2</label><input id="addr2" class="appx-input" type="text"></div>
            <div class="appx-row">
              <div class="appx-field"><label>City *</label><input id="city" class="appx-input" type="text"></div>
              <div class="appx-field"><label>Province/State *</label>
                <select id="region" class="appx-select">
                  <option value="">Select…</option>
                  <option>AB</option><option>BC</option><option>MB</option><option>NB</option><option>NL</option><option>NS</option><option>NT</option><option>NU</option><option>ON</option><option>PE</option><option>QC</option><option>SK</option><option>YT</option>
                  <option>Outside Canada</option>
                </select>
              </div>
            </div>
            <div class="appx-field"><label>Postal / ZIP *</label><input id="postal" class="appx-input" type="text" placeholder="A1A 1A1 / 12345"></div>
            <div class="appx-err" id="err-addr">Please complete your address.</div>
          </section>

          <!-- 9 -->
          <section class="appx-panel" data-step="9">
            <h3 class="appx-h">Do you know your credit score range?</h3>
            <div class="appx-field">
              <select id="credit" class="appx-select">
                <option value="">Select…</option>
                <option value="none">No Credit / Unsure</option>
                <option value="poor">Poor (Under 550)</option>
                <option value="fair">Fair (550–650)</option>
                <option value="good">Good (650–750)</option>
                <option value="excellent">Excellent (Above 750)</option>
              </select>
              <div class="appx-err" id="err-credit">Please choose your credit range.</div>
            </div>
          </section>

          <!-- 10 (Review) -->
          <section class="appx-panel" data-step="10">
            <h3 class="appx-h">Review and authorize</h3>
            <div class="appx-summary" id="appxSummary"></div>
            <label style="display:flex;gap:10px;align-items:flex-start;margin-top:12px"><input id="c1" type="checkbox"> <span>I confirm the information provided is accurate.</span></label>
            <label style="display:flex;gap:10px;align-items:flex-start"><input id="c2" type="checkbox"> <span>I consent to be contacted by phone, text, or email.</span></label>
            <label style="display:flex;gap:10px;align-items:flex-start"><input id="c3" type="checkbox"> <span>I authorize a soft credit inquiry.</span></label>
            <div class="appx-err" id="err-consent">Please accept the required authorizations.</div>
          </section>

          <!-- 11 hidden (skip) -->
          <section class="appx-panel" data-step="11" aria-hidden="true"></section>

          <!-- 12 -->
          <section class="appx-panel" data-step="12">
            <h3 class="appx-h">Thank you! Your application has been received.</h3>
            <p>We’ll get back to you shortly. For faster service, you can call or text us anytime.</p>
            <div class="appx-row" style="margin-top:10px">
              <button class="appx-ghost" id="bookAppt">Book Appointment</button><span></span>
            </div>
          </section>
        </main>

        <footer class="appx-foot">
          <button class="appx-ghost" id="appxPrev">Prev</button>
          <button class="appx-next" id="appxNext">Next →</button>
        </footer>
      </div>
    </div>
  </div>`; document.body.appendChild(wrap.firstElementChild);

  /* ---------- state + nav ---------- */
  const overlay=$('#appTunnel'), btnPrev=$('#appxPrev'), btnNext=$('#appxNext'), bar=$('#appxBar'), stepLabel=$('#appxStepLabel');
  const clamp=(v,min,max)=>Math.max(min,Math.min(max,v));
  const state=ls.get('appx_state',{
    source:null, vehicleType:'', budget:'', dob:null, employment:'',
    name:{first:'',middle:'',last:''},
    contact:{email:'',mobile:'',home:'',smsConsent:true},
    address:{line1:'',line2:'',city:'',region:'',postal:''},
    credit:'', consents:{c1:false,c2:false,c3:false}
  });
  let step=1, maxStep=12; const mapStep=n=>n===11?12:n;

  function renderReview(){
    const el=$('#appxSummary'); if(!el) return;
    const fmt=v=>v && String(v).trim()?String(v).trim():'—';
    const maskedMobile = state.contact.mobile ? phoneMask(state.contact.mobile) : '';
    const maskedHome   = state.contact.home   ? phoneMask(state.contact.home)   : '';
    const addr=[state.address.line1,state.address.line2,state.address.city,state.address.region,state.address.postal].filter(Boolean).join(', ');
    el.innerHTML = `<dl>
      <dt>Vehicle Type</dt><dd>${fmt(state.vehicleType)}</dd>
      <dt>Monthly Budget</dt><dd>${fmt(state.budget)}</dd>
      <dt>Date of Birth</dt><dd>${fmt(state.dob)}</dd>
      <dt>Employment</dt><dd>${fmt(state.employment)}</dd>
      <dt>Full Name</dt><dd>${fmt([state.name.first,state.name.middle,state.name.last].filter(Boolean).join(' '))}</dd>
      <dt>Email</dt><dd>${fmt(state.contact.email)}</dd>
      <dt>Mobile</dt><dd>${fmt(maskedMobile)}</dd>
      <dt>Home Phone</dt><dd>${fmt(maskedHome)}</dd>
      <dt>Address</dt><dd>${fmt(addr)}</dd>
      <dt>Credit Range</dt><dd>${fmt(state.credit)}</dd>
    </dl>`;
  }

  function setStep(n){
    step=clamp(n,1,maxStep);
    $$('#appxPanels .appx-panel').forEach(p=>p.classList.remove('active'));
    $(`#appxPanels .appx-panel[data-step="${mapStep(step)}"]`)?.classList.add('active');
    btnPrev.disabled=(step===1);
    btnNext.textContent=(step===10)?'Submit Application':(step>=11?'Finish →':'Next →');
    const labels=['Vehicle Type','Budget','DOB','Employment','Pre-Approval','Your Name','Contact','Address','Credit Range','Review','Appointment','Confirmation'];
    stepLabel.textContent=`Step ${step} of 12 • ${labels[step-1]}`;
    bar.style.width=`${Math.round((step)/12*100)}%`;
    if(step===10) renderReview();
    if(step===12){ const s12=$('[data-step="12"]'); s12.classList.remove('step-12-animate'); void s12.offsetWidth; s12.classList.add('step-12-animate'); }
  }

  const open=(src='cta')=>{ state.source=src; ls.set('appx_state',state); setStep(1); overlay.setAttribute('aria-hidden','false'); document.body.style.overflow='hidden'; };
  const close=()=>{ overlay.setAttribute('aria-hidden','true'); document.body.style.overflow=''; };
  window.openApplicationTunnel=open; window.closeApplicationTunnel=close;

  $('#appxClose').addEventListener('click', close);
  overlay.addEventListener('click', e=>{ if(e.target===overlay) close(); });
  window.addEventListener('keydown', e=>{ if(e.key==='Escape'&&overlay.getAttribute('aria-hidden')==='false') close(); });

  btnPrev.addEventListener('click', ()=>setStep(step-1));
  btnNext.addEventListener('click', ()=>{ if(!validateStep(true)) return;
    if(step===10){ submitApplication(); return; }
    if(step===11){ setStep(12); return; }
    if(step===12){ close(); return; }
    setStep(step+1);
  });

  /* ---------- per-step wiring ---------- */
  // 1
  const typeCards=$$('#appxTypeCards .appx-card');
  typeCards.forEach(b=>b.addEventListener('click',()=>{
    typeCards.forEach(x=>x.classList.remove('selected'));
    b.classList.add('selected');
    state.vehicleType=b.dataset.val; ls.set('appx_state',state);
    $('#err-type')?.classList.remove('show');
  }));

  // 2
  $('#appxBudget')?.addEventListener('change',e=>{
    state.budget=e.target.value; ls.set('appx_state',state);
    $('#err-budget')?.classList.remove('show');
  });

  // 3
  (function fillDOB(){
    const d=$('#dobDay'), m=$('#dobMonth'), y=$('#dobYear'); if(!d||!m||!y) return;
    d.innerHTML='<option value="">Day</option>'+Array.from({length:31},(_,i)=>`<option>${i+1}</option>`).join('');
    m.innerHTML='<option value="">Month</option>'+['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'].map((mm,i)=>`<option value="${i+1}">${mm}</option>`).join('');
    const now=new Date().getFullYear(); let yhtml='<option value="">Year</option>'; for(let yy=now-18; yy>=now-100; yy--) yhtml+=`<option>${yy}</option>`; y.innerHTML=yhtml;
    [d,m,y].forEach(sel=>sel.addEventListener('change',()=>{ const dd=+d.value, mm=+m.value, yy=+y.value;
      state.dob=(dd&&mm&&yy)?new Date(yy,mm-1,dd).toISOString().slice(0,10):null; ls.set('appx_state',state); $('#err-dob')?.classList.remove('show');
    }));
  })();

  // 4
  const empSel=$('#appxEmp');
  empSel?.addEventListener('change',()=>{ state.employment=empSel.value; ls.set('appx_state',state); $('#err-emp')?.classList.remove('show'); });

  // 6
  const f=$('#firstName'), md=$('#middleName'), l=$('#lastName');
  [f,md,l].forEach(i=>i?.addEventListener('input',()=>{ state.name.first=f?.value.trim()||''; state.name.middle=md?.value.trim()||''; state.name.last=l?.value.trim()||''; ls.set('appx_state',state); $('#err-name')?.classList.remove('show'); }));

  // 7 — Contact: phone masking + relaxed validation (email only required)
  (function wireContactStep(){
    const emailEl=$('#email'), mobileEl=$('#mobile'), homeEl=$('#home');
    const reMask = (el)=>{ if(!el) return; const pos=el.selectionStart||0; el.value=phoneMask(el.value); try{ el.setSelectionRange(pos,pos);}catch(_){ } };
    [mobileEl,homeEl].forEach(el=>el?.addEventListener('input',()=>{ reMask(el); window.validateContact(false); },{capture:true}));
    emailEl?.addEventListener('input',()=>window.validateContact(false),{capture:true});

    window.validateContact=function(show){
      const err=$('#err-contact');
      const email=(emailEl?.value||'').trim();
      const mobileDigits=digits(mobileEl?.value||'').replace(/^1/,''); // stored, but not required
      const homeDigits  =digits(homeEl?.value||'').replace(/^1/,'');

      state.contact.email=email;
      state.contact.mobile=mobileDigits;
      state.contact.home=homeDigits;
      state.contact.smsConsent=true;
      ls.set('appx_state',state);

      const ok=emailOk(email);  // <-- Only email is required
      if(show&&err){
        if(!ok){ err.textContent='Enter a valid email.'; err.classList.add('show'); }
        else   { err.classList.remove('show'); }
      }
      return ok;
    };
  })();

  // 8 addr + 9 credit
  const addr1=$('#addr1'), addr2=$('#addr2'), city=$('#city'), region=$('#region'), postal=$('#postal');
  [addr1,addr2,city,region,postal].forEach(i=>i?.addEventListener('input',()=>{ 
    state.address.line1=addr1?.value.trim()||''; state.address.line2=addr2?.value.trim()||'';
    state.address.city=city?.value.trim()||'';   state.address.region=region?.value.trim()||'';
    state.address.postal=postal?.value.trim()||''; ls.set('appx_state',state); $('#err-addr')?.classList.remove('show');
  }));
  region?.addEventListener('change',()=>{ state.address.region=region.value; ls.set('appx_state',state); });
  $('#credit')?.addEventListener('change', e=>{ state.credit=e.target.value; ls.set('appx_state',state); $('#err-credit')?.classList.remove('show'); });

  /* ---------- validate + submit ---------- */
  function validateStep(show=false){
    switch(step){
      case 1: if(!state.vehicleType){ if(show) $('#err-type')?.classList.add('show'); return false; } return true;
      case 2: if(!state.budget){ if(show) $('#err-budget')?.classList.add('show'); return false; } return true;
      case 3: if(!state.dob){ if(show) $('#err-dob')?.classList.add('show'); return false; } return true;
      case 4: if(!state.employment){ if(show) $('#err-emp')?.classList.add('show'); return false; } return true;
      case 6: if(!(state.name.first&&state.name.last)){ if(show) $('#err-name')?.classList.add('show'); return false; } return true;
      case 7: return window.validateContact(show);
      case 8: { const ok=!!(state.address.line1 && state.address.city && state.address.region && state.address.postal); if(!ok&&show) $('#err-addr')?.classList.add('show'); return ok; }
      case 9: if(!state.credit){ if(show) $('#err-credit')?.classList.add('show'); return false; } return true;
      case 10:{ const c1=$('#c1')?.checked, c2=$('#c2')?.checked, c3=$('#c3')?.checked; if(!(c1&&c2&&c3)){ if(show) $('#err-consent')?.classList.add('show'); return false; } state.consents={c1,c2,c3}; ls.set('appx_state',state); return true; }
      default: return true;
    }
  }

  function submitApplication(){
    // TODO: replace with your real submit
    suppressWinter();
    window.dispatchEvent(new Event('app_tunnel_finished'));
    setStep(11); setStep(12);
  }

  /* ---------- CTA routing: “Get me approved / Apply Online / Get Started” → Application ---------- */
  (function(){
    const MATCH=//b(get/s*me/s*approved|apply/s*online|get/s*started)/b/i;
    const SEL='[data-tunnel-trigger="get-started"],[data-cta="get-approved"],.approved,.cta-btn';
    function shouldOpen(el){ if(!el) return false; const t=(el.textContent||el.value||'').trim(); return MATCH.test(t) || el.matches(SEL); }
    document.addEventListener('click',(e)=>{ const t=e.target.closest('a,button'); if(!t) return; if(!shouldOpen(t)) return; e.preventDefault(); e.stopPropagation(); open('cta:get-approved'); }, true);
  })();

  // Book Appointment on final step routes to your scheduler tunnel
  (function wireBook(){
    function openSchedule(){ if(typeof openOfferTunnel==='function'){ openOfferTunnel(); } else { document.getElementById('offerTunnel')?.setAttribute('aria-hidden','false'); } }
    $('#bookAppt')?.addEventListener('click',(e)=>{ e.preventDefault(); openSchedule(); });
  })();
})();

/* ==================== OPTIONAL: Router hardening for other CTAs ==================== */
(function ROUTER_V3_MIN(){
  const $ = s=>document.querySelector(s);
  const APP_TXT=/(get/s*me/s*approved|apply/s*online|get/s*started)/i;
  const APP_SEL='[data-tunnel-trigger="get-started"],[data-cta="get-approved"],.approved,.cta-btn';
  const OFFER_SEL='[data-tunnel-trigger="schedule-appointment"],[data-tunnel-trigger="book-appointment"],[data-tunnel-trigger="get-best-deal"],.learn-more,.cta-ghost,.cta-red';
  document.addEventListener('click',(e)=>{
    const t=e.target.closest('a,button'); if(!t) return;
    const txt=(t.textContent||t.value||'').trim().toLowerCase();
    if (APP_TXT.test(txt)||t.matches(APP_SEL)){ e.preventDefault(); e.stopPropagation(); window.openApplicationTunnel?.('click'); }
    else if (t.matches(OFFER_SEL)||/(schedule|book|best/s*deal|trade[-/s]?in)/i.test(txt)){ e.preventDefault(); e.stopPropagation(); window.openOfferTunnel?.('click'); }
  }, true);
})();
</script>


<!-- ===== Winter 4-Step (compact) — replace entire previous Winter section ===== -->
<div id="Winter4x" class="Winter4x-overlay" aria-hidden="true" role="dialog" aria-modal="true" aria-label="Claim your Winter Bonus">
  <style>
    .Winter4x-overlay{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(8,12,20,.78);backdrop-filter:blur(8px);z-index:10090;padding:16px}
    .Winter4x-overlay[aria-hidden="false"]{display:flex}
    .Winter4x-modal{width:min(760px,92vw);background:#0f141c;color:#e9f0ff;border-radius:16px;overflow:hidden;border:1px solid rgba(255,255,255,.12);box-shadow:0 40px 120px rgba(0,0,0,.6);position:relative}
    .Winter4x-head{background:radial-gradient(1000px 420px at -10% -30%, rgba(194,38,54,.22), transparent), #0f141c;padding:12px 14px;border-bottom:1px solid rgba(255,255,255,.10)}
    .Winter4x-title{margin:0 0 2px;font-size:20px;font-weight:900}
    .Winter4x-sub{margin:0;color:#bcd1ff;font-weight:800;font-size:13px}
    .Winter4x-close{position:absolute;top:8px;right:10px;background:transparent;border:0;color:#e9f0ff;font-size:22px;cursor:pointer}
    .Winter4x-tabs{display:flex;gap:8px;margin-top:8px}
    .Winter4x-tab{display:flex;align-items:center;gap:8px;background:#141b25;border:1px solid rgba(255,255,255,.12);color:#a9b9d8;border-radius:999px;padding:6px 12px;font-weight:900}
    .Winter4x-tab.active{background:linear-gradient(90deg,#C22636,#971B29);color:#fff;border-color:transparent}
    .Winter4x-body{padding:12px;min-height:360px}
    .Winter4x-panel{display:none}.Winter4x-panel.active{display:block}
    .Winter4x-field{display:grid;gap:6px;margin:8px 0 10px}
    .Winter4x-input{width:100%;padding:10px;border-radius:12px;border:1px solid rgba(255,255,255,.18);background:#0b1118;color:#e9f0ff}
    .Winter4x-perks{display:grid;grid-template-columns:repeat(3,1fr);gap:10px;margin:8px 0 0}
    @media (max-width:740px){.Winter4x-perks{grid-template-columns:1fr}}
    .Winter4x-perk{display:flex;gap:10px;align-items:center;background:#111826;border:1px solid rgba(255,255,255,.10);border-radius:12px;padding:10px}
    .Winter4x-type-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:10px}
    @media (max-width:720px){.Winter4x-type-grid{grid-template-columns:repeat(2,1fr)}}
    .Winter4x-tile{border:1px solid #e6eaf2;border-radius:14px;overflow:hidden;background:#fff;color:#0b1220;cursor:pointer;display:grid;grid-template-rows:auto 40px;box-shadow:0 8px 18px rgba(0,0,0,.08)}
    .Winter4x-tile figure{margin:0;display:grid;place-items:center;height:100px;background:#f8fafc}
    .Winter4x-tile footer{display:grid;place-items:center;font-weight:900}
    .Winter4x-tile.selected{outline:3px solid rgba(194,38,54,.28);box-shadow:0 16px 34px rgba(194,38,54,.22)}
    .Winter4x-scheduler{display:grid;grid-template-columns:1fr 1fr;gap:10px}
    @media (max-width:720px){.Winter4x-scheduler{grid-template-columns:1fr}}
    .Winter4x-cal,.Winter4x-slots{background:#fff;color:#0b1220;border:1px solid #e6eaf2;border-radius:12px;padding:8px;box-shadow:0 8px 22px rgba(0,0,0,.12)}
    .Winter4x-cal-head{display:flex;justify-content:space-between;align-items:center;margin-bottom:6px}
    .Winter4x-month{font-weight:900}
    .Winter4x-chevron{background:#0b1220;color:#fff;border:0;border-radius:10px;width:34px;height:34px;display:grid;place-items:center;font-size:18px;cursor:pointer}
    .Winter4x-dow,.Winter4x-day{text-align:center;padding:8px 0;border-radius:8px;font-weight:800}
    .Winter4x-grid{display:grid;grid-template-columns:repeat(7,1fr);gap:5px}
    .Winter4x-dow{background:#f1f5ff;color:#1f2937;border:1px solid #e6eaf2;font-size:12px}
    .Winter4x-day{background:#fff;border:1px solid #e6eaf2;cursor:pointer}
    .Winter4x-day.other,.Winter4x-day.disabled{opacity:.45;cursor:not-allowed;background:#f5f6fb}
    .Winter4x-day.selected{outline:3px solid rgba(194,38,54,.25);background:#fff0f2}
    .Winter4x-slots header{font-weight:900;margin-bottom:6px}
    .Winter4x-slot-list{display:grid;grid-template-columns:repeat(2,1fr);gap:8px;max-height:200px;overflow:auto}
    @media (max-width:720px){.Winter4x-slot-list{grid-template-columns:1fr}}
    .Winter4x-slot{background:#fff;border:1px solid #e6eaf2;border-radius:8px;padding:10px;text-align:center;font-weight:900;cursor:pointer}
    .Winter4x-slot.selected{outline:3px solid rgba(194,38,54,.25);background:#fff0f2}
    .Winter4x-slot-empty{grid-column:1/-1;color:#475569}
    .Winter4x-codebox{margin-top:6px;padding:12px;border-radius:14px;border:1px dashed #3B82F6;background:#f5f9ff;color:#0b1220;display:grid;gap:8px;justify-items:center}
    .Winter4x-code{font-family:ui-monospace,Menlo,Consolas,monospace;font-weight:900;letter-spacing:.18em;font-size:20px}
    .Winter4x-actions{display:flex;justify-content:space-between;gap:10px;padding:8px 12px;background:linear-gradient(180deg,rgba(15,20,28,0),rgba(15,20,28,.92) 40%)}
    .Winter4x-btn{appearance:none;border:0;border-radius:10px;padding:10px 14px;font-weight:900;cursor:pointer}
    .Winter4x-btn.ghost{background:#0b1118;color:#e9f0ff;border:1px solid rgba(255,255,255,.18)}
    .Winter4x-btn.primary{background:linear-gradient(90deg,#C22636,#971B29);color:#fff;box-shadow:0 14px 36px rgba(194,38,54,.36)}
    .Winter4x-btn.primary[disabled]{filter:grayscale(1);opacity:.6;cursor:not-allowed}
    /* hide footer on last step */
    #Winter4x.is-last .Winter4x-actions{display:none}
  </style>

  <div class="Winter4x-modal" role="document">
    <button class="Winter4x-close" aria-label="Close">×</button>
    <header class="Winter4x-head">
      <h3 class="Winter4x-title">Claim your Winter Bonus</h3>
      <p class="Winter4x-sub">Winter Welcome — 4 quick steps.</p>
      <nav class="Winter4x-tabs" aria-label="Steps">
        <div class="Winter4x-tab active">• Name & Phone</div>
        <div class="Winter4x-tab">○ Vehicle Type</div>
        <div class="Winter4x-tab">○ Schedule</div>
        <div class="Winter4x-tab">○ Your Code</div>
      </nav>
    </header>

    <div class="Winter4x-body">
      <!-- Step 1 -->
      <section class="Winter4x-panel active" data-step="1">
        <h4 style="margin:.2rem 0 .6rem">Let’s start with your details</h4>
        <div class="Winter4x-field"><label for="vxName">Full Name *</label><input id="vxName" class="Winter4x-input" type="text" placeholder="Jane Smith" autocomplete="name"></div>
        <div class="Winter4x-field"><label for="vxPhone">Mobile *</label><input id="vxPhone" class="Winter4x-input" type="tel" inputmode="tel" placeholder="(204) 555-1234" autocomplete="tel"></div>
        <div style="margin:10px 0 6px;color:#bcd1ff;font-weight:800">Your Winter Bonus includes:</div>
        <div class="Winter4x-perks">
          <div class="Winter4x-perk"><div>⛽️</div><div><strong>Full Tank of Gas</strong><div>on delivery</div></div></div>
          <div class="Winter4x-perk"><div>💳</div><div><strong>Visa Gift Card</strong><div>spend anywhere</div></div></div>
          <div class="Winter4x-perk"><div>🎁</div><div><strong>Surprise Bonus</strong><div>revealed at delivery</div></div></div>
        </div>
      </section>

      <!-- Step 2 -->
      <section class="Winter4x-panel" data-step="2">
        <h4 style="margin:.2rem 0 .6rem">Choose your vehicle type</h4>
        <div class="Winter4x-type-grid" id="vxTypeGrid">
          <button class="Winter4x-tile" data-type="Truck"><figure><img src="/images/car-icons/pickup-truck-svgrepo-com.svg" alt=""></figure><footer>Truck</footer></button>
          <button class="Winter4x-tile" data-type="SUV"><figure><img src="/images/car-icons/suv-svgrepo-com.svg" alt=""></figure><footer>SUV</footer></button>
          <button class="Winter4x-tile" data-type="Minivan"><figure><img src="images/car-icons/car real.svg" alt=""></figure><footer>Minivan</footer></button>
<button class="Winter4x-tile" data-type="Car"><figure><img src="../images/Car.svg" alt=""></figure><footer>Car</footer>
</button>
        </div>
        <div style="color:#8aa2d6;margin-top:6px">*You can change this later.</div>
      </section>

      <!-- Step 3 -->
      <section class="Winter4x-panel" data-step="3">
        <h4 style="margin:.2rem 0 .6rem">Pick a time</h4>
        <div style="color:#6b7ea3;margin:-2px 0 8px;font-weight:800">Hours: Mon 1–8pm • Tue–Sat 10am–5pm • Sun closed</div>
        <div class="Winter4x-scheduler">
          <div class="Winter4x-cal">
            <header class="Winter4x-cal-head">
              <button class="Winter4x-chevron" id="vxCalPrev" aria-label="Previous month">‹</button>
              <strong class="Winter4x-month" id="vxMonth">Month YYYY</strong>
              <button class="Winter4x-chevron" id="vxCalNext" aria-label="Next month">›</button>
            </header>
            <div class="Winter4x-grid" id="vxGrid"></div>
          </div>
          <div class="Winter4x-slots">
            <header>Available times</header>
            <div class="Winter4x-slot-list" id="vxSlots"><div class="Winter4x-slot-empty">Select a date to see times.</div></div>
          </div>
        </div>
      </section>

      <!-- Step 4 -->
      <section class="Winter4x-panel" data-step="4">
        <h4 style="margin:.2rem 0 .6rem">Your Winter bonus code</h4>
        <div class="Winter4x-codebox">
          <div><strong>Your Winter Code:</strong></div>
          <div class="Winter4x-code" id="vxCode">Winter-XXXX-XXXX</div>
          <div style="display:flex;gap:10px;flex-wrap:wrap">
            <button class="Winter4x-btn primary" id="vxCopy">Copy Code</button>
            <button class="Winter4x-btn ghost" id="vxDone">Done</button>
          </div>
          <small style="color:#334155">Show this code at delivery to redeem your perks.</small>
        </div>
      </section>
    </div>

    <footer class="Winter4x-actions" id="vxFooter">
      <button class="Winter4x-btn ghost" id="vxBack">Back</button>
      <button class="Winter4x-btn primary" id="vxNextStep" disabled>Continue</button>
    </footer>
  </div>
</div>

<script>
/* Winter 4-step wiring (compact, caret-safe phone mask, hour slots, hide footer on last step) */
(function(){
  const root = document.getElementById('Winter4x');
  const $  = sel => root.querySelector(sel);
  const $$ = sel => [...root.querySelectorAll(sel)];

  // ---------- state + nav ----------
  const tabs=$$('.Winter4x-tab'), panels=$$('.Winter4x-panel');
  const btnBack=$('#vxBack'), btnNext=$('#vxNextStep'), footer=$('#vxFooter');
  let step=1, selType=null, selDate=null, selTime=null;

  function setStep(n){
    step=Math.max(1,Math.min(4,n));
    panels.forEach((p,i)=>p.classList.toggle('active',i===step-1));
    tabs.forEach((t,i)=>t.classList.toggle('active',i===step-1));
    btnBack.disabled=(step===1);
    if(step===1) checkStep1();
    if(step===2) btnNext.disabled=!selType;
    if(step===3) btnNext.disabled=!(selDate&&selTime);
    // Hide footer on final step
    if(step===4){ root.classList.add('is-last'); footer.style.display='none'; } else { root.classList.remove('is-last'); footer.style.display='flex'; }
  }
  function open(){ root.setAttribute('aria-hidden','false'); document.body.style.overflow='hidden'; setStep(1); }
  function close(){ root.setAttribute('aria-hidden','true'); document.body.style.overflow=''; }
  $('.Winter4x-close').addEventListener('click',close);
  root.addEventListener('click',e=>{ if(e.target===root) close(); });
  window.addEventListener('keydown',e=>{ if(e.key==='Escape'&&root.getAttribute('aria-hidden')==='false') close(); });
  btnBack.addEventListener('click',()=>setStep(step-1));
  btnNext.addEventListener('click',()=>{ if(step===3){ generateCode(); } setStep(step+1); });

  // Optional: wire your Claim Now button if present
  document.addEventListener('click', (e) => {
    const btn = e.target.closest('#claimNowBtn');
    if (!btn) return;
    e.preventDefault();
    open();
  }, true);

  // ---------- Step 1: validation + caret-safe phone mask ----------
  const nameEl=$('#vxName'), phoneEl=$('#vxPhone');

  const onlyDigits = v => (v||'').replace(//D/g,'');
  function formatNA10(d){
    // d is only digits, max 10
    if(!d) return '';
    if(d.length<=3) return '('+d;
    if(d.length<=6) return `(${d.slice(0,3)}) ${d.slice(3)}`;
    return `(${d.slice(0,3)}) ${d.slice(3,6)}-${d.slice(6)}`;
  }
  function maskPhoneCaretSafe(ev){
    const prev = phoneEl.value;
    const caret = phoneEl.selectionStart || 0;
    const digitsBeforeCaret = prev.slice(0, caret).replace(//D/g,'').length;

    let d = onlyDigits(prev);
    if(d.length>10 && d.startsWith('1')) d = d.slice(1);
    d = d.slice(0,10);

    const next = formatNA10(d);
    phoneEl.value = next;

    // place caret after the same count of digits
    let pos = 0, seen=0;
    for(let i=0;i<next.length;i++){
      if(//d/.test(next[i])) seen++;
      if(seen>=digitsBeforeCaret){ pos = i+1; break; }
      pos = i+1;
    }
    try{ phoneEl.setSelectionRange(pos,pos);}catch(_){}
    checkStep1();
  }
  function checkStep1(){
    const okName = nameEl.value.trim().length>=2;
    let d = onlyDigits(phoneEl.value);
    if(d.length>10 && d.startsWith('1')) d = d.slice(1);
    const okPhone = d.length===10;
    btnNext.disabled = !(okName && okPhone);
  }
  nameEl.addEventListener('input', checkStep1);
  // Mask on input without jumping caret
  phoneEl.addEventListener('input', maskPhoneCaretSafe);
  // Also normalize on blur
  phoneEl.addEventListener('blur', maskPhoneCaretSafe);

  // ---------- Step 2: type select ----------
  $$('#vxTypeGrid .Winter4x-tile').forEach(tile=>{
    tile.addEventListener('click', ()=>{
      $$('#vxTypeGrid .Winter4x-tile').forEach(x=>x.classList.remove('selected'));
      tile.classList.add('selected'); selType = tile.dataset.type || null;
      btnNext.disabled = !selType;
    });
  });

  // ---------- Step 3: calendar + hour slots ----------
  const monthLbl=$('#vxMonth'), grid=$('#vxGrid'), slotsBox=$('#vxSlots');
  const prevBtn=$('#vxCalPrev'), nextBtn=$('#vxCalNext');
  let cal=new Date(); cal.setDate(1);

  function renderCal(){
    grid.innerHTML='';
    const m=cal.getMonth(), y=cal.getFullYear();
    monthLbl.textContent = `${cal.toLocaleString('default',{month:'long'})} ${y}`;
    const first=new Date(y,m,1), start=(first.getDay()+7)%7, days=new Date(y,m+1,0).getDate(), total=Math.ceil((start+days)/7)*7;

    // headers
    ['Sun','Mon','Tue','Wed','Thu','Fri','Sat'].forEach(d=>{
      const el=document.createElement('div'); el.className='Winter4x-dow'; el.textContent=d; grid.appendChild(el);
    });

    for(let i=0;i<total;i++){
      const day=i-start+1, b=document.createElement('button'); b.type='button'; b.className='Winter4x-day';
      if(day<=0||day>days){
        b.textContent=new Date(y,m,day).getDate(); b.classList.add('other'); b.disabled=true;
      } else {
        b.textContent=day;
        const d=new Date(y,m,day), today=new Date(); today.setHours(0,0,0,0);
        const dd=new Date(d); dd.setHours(0,0,0,0);
        if(dd<today || d.getDay()===0){ b.classList.add('disabled'); b.disabled=true; } // no past + no Sundays
        if(selDate && dd.getTime()===selDate.getTime()) b.classList.add('selected');
        b.addEventListener('click', ()=>{
          selDate=dd; selTime=null; renderSlots();
          $$('.Winter4x-day',grid).forEach(x=>x.classList.remove('selected')); b.classList.add('selected');
          btnNext.disabled = true;
        });
      }
      grid.appendChild(b);
    }
  }

  function fmtHour(h){ return `${((h+11)%12)+1}:00 ${h<12?'AM':'PM'}`; }

  function renderSlots(){
    slotsBox.innerHTML='';
    if(!selDate){ slotsBox.innerHTML='<div class="Winter4x-slot-empty">Select a date to see times.</div>'; return; }

    // hours: Mon 13–20, Tue–Sat 10–17 (hourly). Sun closed handled above.
    const dow = selDate.getDay();
    let startH=10, endH=17;
    if(dow===1){ startH=13; endH=20; } // Monday
    if(dow===0){ slotsBox.innerHTML='<div class="Winter4x-slot-empty">Closed on Sundays.</div>'; return; }

    const now = new Date(), isToday = now.toDateString()===selDate.toDateString();
    const list=[];
    for(let h=startH; h<=endH; h++){
      const t=new Date(selDate); t.setHours(h,0,0,0);
      if(isToday && t<now) continue; // no past times today
      list.push({t,label:fmtHour(h)});
    }
    if(!list.length){ slotsBox.innerHTML='<div class="Winter4x-slot-empty">No remaining times today.</div>'; return; }

    list.forEach(({t,label})=>{
      const b=document.createElement('button'); b.type='button'; b.className='Winter4x-slot'; b.textContent=label;
      b.addEventListener('click', ()=>{
        selTime=t; $$('.Winter4x-slot',slotsBox).forEach(x=>x.classList.remove('selected')); b.classList.add('selected');
        btnNext.disabled = false;
      });
      slotsBox.appendChild(b);
    });
  }

  prevBtn.addEventListener('click',()=>{ cal.setMonth(cal.getMonth()-1); renderCal(); });
  nextBtn.addEventListener('click',()=>{ cal.setMonth(cal.getMonth()+1); renderCal(); });
  renderCal();

  // ---------- Step 4: code ----------
  function genCode(){
    const C='ABCDEFGHJKLMNPQRSTUVWXYZ23456789';
    const s=n=>Array.from({length:n},()=>C[(Math.random()*C.length)|0]).join('');
    return `Winter-${s(4)}-${s(4)}`;
  }
  function generateCode(){
    const code = genCode();
    $('#vxCode').textContent = code;
    try{ localStorage.setItem('Winter_code', code);}catch(_){}
  }
  $('#vxCopy').addEventListener('click', async ()=>{
    try{ await navigator.clipboard.writeText($('#vxCode').textContent.trim()); }catch(_){}
  });
  $('#vxDone').addEventListener('click', close);

  // expose opener if you want to trigger it from elsewhere
  window.openWinter4x = open;
})();
</script>


<script>
/* ===== PHONE CURSOR FIX v2 — Refer + Application (Contact) + Contact Tunnel ===== */
(function(){
  const DIGITS = s => (s||'').replace(//D/g,'');
  const fmt10  = d=>{
    if(!d) return '';
    if(d.length<=3) return '('+d;
    if(d.length<=6) return `(${d.slice(0,3)}) ${d.slice(3)}`;
    return `(${d.slice(0,3)}) ${d.slice(3,6)}-${d.slice(6)}`;
  };

  function setMaskedValueCaretSafe(el){
    if(!el) return;
    const prev  = el.value || '';
    const caret = el.selectionStart ?? prev.length;

    // digits before caret (so we can restore it)
    const digitsBefore = prev.slice(0, caret).replace(//D/g,'').length;

    // normalize digits
    let d = DIGITS(prev);
    if (d.length > 10 && d[0] === '1') d = d.slice(1);
    d = d.slice(0,10);

    const next = fmt10(d);
    if (next !== prev) el.value = next;

    // restore caret after the same digit index
    let pos = 0, seen = 0;
    for (let i=0; i<next.length; i++){
      if (//d/.test(next[i])) seen++;
      if (seen >= digitsBefore){ pos = i+1; break; }
      pos = i+1;
    }
    try { el.setSelectionRange(pos,pos); } catch(_){}

    // custom event so existing validation can re-run
    el.dispatchEvent(new CustomEvent('phone:masked', {bubbles:false}));
  }

  /**
   * Replaces an input with a clone (to strip old listeners) and installs caret-safe mask.
   * Also calls the provided "onMasked" each time we reformat.
   */
  function bindCaretMask(el, {stripOld=true, onMasked} = {}){
    if(!el) return null;

    if(stripOld){
      const clone = el.cloneNode(true);
      el.replaceWith(clone);
      el = clone;
    }

    const handler = () => requestAnimationFrame(()=> {
      setMaskedValueCaretSafe(el);
      onMasked?.(el);
    });

    el.addEventListener('input', handler);
    el.addEventListener('blur',  handler);

    // initial normalize
    handler();
    return el;
  }

  /* ================= REFER MODAL ================= */
  const rfYour   = document.getElementById('rfYourPhone');
  const rfFriend = document.getElementById('rfFriendPhone');
  const rfName   = document.getElementById('rfYourName');
  const rfFName  = document.getElementById('rfFriendName');
  const rfBtn    = document.getElementById('referSubmit');

  function updReferBtn(){
    if(!rfBtn) return;
    const ok =
      DIGITS(rfYour?.value).length   === 10 &&
      DIGITS(rfFriend?.value).length === 10 &&
      (rfName?.value||'').trim().length  >= 2 &&
      (rfFName?.value||'').trim().length >= 2;
    rfBtn.disabled = !ok;
  }

  bindCaretMask(rfYour,   {onMasked: updReferBtn});
  bindCaretMask(rfFriend, {onMasked: updReferBtn});
  rfName   ?.addEventListener('input', updReferBtn);
  rfFName  ?.addEventListener('input', updReferBtn);
  updReferBtn();

  /* ================= APPLICATION TUNNEL (CONTACT STEP) ================= */
  // These ids come from your Application tunnel Step 7
  const appMobile = document.getElementById('mobile');
  const appHome   = document.getElementById('home');

  function triggerValidateContact(){
    // Use your existing validator if present (keeps your error messages).
    if (typeof window.validateContact === 'function'){
      window.validateContact(false);
    }
  }

  bindCaretMask(appMobile, {onMasked: triggerValidateContact});
  bindCaretMask(appHome,   {onMasked: triggerValidateContact});

  /* ================= CONTACT TUNNEL (the 3-step contact pop) ================= */
  const ctPhone = document.getElementById('ctPhone');
  const ctNext  = document.getElementById('ctTo4');
  function updCtNext(){
    if(!ctNext) return;
    ctNext.disabled = DIGITS(ctPhone?.value).length !== 10;
  }
  bindCaretMask(ctPhone, {onMasked: updCtNext});
  updCtNext();
})();
</script>
<script>
/* CONTACT TUNNEL — FORCE caret-safe mask for #ctPhone (blocks other handlers) */
(function contactPhoneFixForce(){
  const DIGITS = s => (s||'').replace(//D/g,'');
  const fmt10  = d=>{
    if(!d) return '';
    if(d.length<=3) return '('+d;
    if(d.length<=6) return `(${d.slice(0,3)}) ${d.slice(3)}`;
    return `(${d.slice(0,3)}) ${d.slice(3,6)}-${d.slice(6)}`;
  };

  function caretMask(el){
    const prev  = el.value || '';
    const caret = el.selectionStart ?? prev.length;
    const digitsBefore = prev.slice(0, caret).replace(//D/g,'').length;

    let d = DIGITS(prev);
    if (d.length>10 && d[0]==='1') d = d.slice(1);
    d = d.slice(0,10);

    const next = fmt10(d);
    if (next !== prev) el.value = next;

    // restore caret after same digit index
    let pos = 0, seen = 0;
    for (let i=0;i<next.length;i++){
      if (//d/.test(next[i])) seen++;
      if (seen >= digitsBefore){ pos = i+1; break; }
      pos = i+1;
    }
    try { el.setSelectionRange(pos,pos); } catch(_){}

    el.dispatchEvent(new CustomEvent('phone:masked', {bubbles:false}));
  }

  function bindCtPhone(){
    const container = document.getElementById('contactTunnel') || document;
    const old = container.querySelector('#ctPhone') || document.getElementById('ctPhone');
    if (!old || old.dataset.ctMaskBound === '1') return;

    // clone to strip old listeners
    const el = old.cloneNode(true);
    old.replaceWith(el);
    el.id = 'ctPhone';
    el.dataset.ctMaskBound = '1';
    el.autocomplete = 'tel';
    el.inputMode    = 'tel';

    // our handler + hard shield (capture + stopImmediatePropagation)
    const shield = (e)=>{
      // format with caret safety
      requestAnimationFrame(()=> caretMask(el));
      // stop any other masks from running on this field
      e.stopPropagation();
      e.stopImmediatePropagation();
    };

    ['input','blur','keyup','keydown','paste'].forEach(evt=>{
      el.addEventListener(evt, shield, /* capture */ true);
    });

    // initial normalize
    requestAnimationFrame(()=> caretMask(el));

    // keep the Continue button state in sync
    const btn = document.getElementById('ctTo4');
    const check = () => { if (btn) btn.disabled = DIGITS(el.value).length < 10; };
    el.addEventListener('phone:masked', check, true);
    el.addEventListener('input',       check, true);
    check();
  }

  // Run now…
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', bindCtPhone);
  } else {
    bindCtPhone();
  }

  // …and re-run whenever the Contact tunnel opens / Step 3 mounts
  const root = document.getElementById('contactTunnel') || document.body;
  new MutationObserver((muts)=>{
    for (const m of muts){
      if (m.type === 'attributes' && (m.target.id === 'contactTunnel') && m.attributeName === 'aria-hidden'){
        bindCtPhone();
      }
      if (m.type === 'childList' && [...m.addedNodes].some(n => n.nodeType===1 && (n.id==='ctStep3' || n.querySelector?.('#ctPhone')))){
        bindCtPhone();
      }
    }
  }).observe(root, {subtree:true, childList:true, attributes:true, attributeFilter:['class','aria-hidden']});
})();
</script>



<script>
/* ===== Message Now — right-side + auto-hide while open + sit ABOVE Winter sticky ===== */
(function MSG_NOW_V13(){
  if (window.__msgNowInit) return; window.__msgNowInit = true;

  const $  = (s,p=document)=>p.querySelector(s);
  const digits = v => (v||'').replace(//D/g,'');
  const maskPhone = v => {
    const d = digits(v).replace(/^1/,'').slice(0,10);
    if (!d) return '';
    if (d.length <= 3) return d;
    if (d.length <= 6) return `(${d.slice(0,3)}) ${d.slice(3)}`;
    return `(${d.slice(0,3)}) ${d.slice(3,6)}-${d.slice(6)}`;
  };
  const setLS = (k,v)=>{ try{localStorage.setItem(k,JSON.stringify(v));}catch(_){} };
  const getLS = (k,def)=>{ try{const v=localStorage.getItem(k); return v?JSON.parse(v):def;}catch(_){return def;} };

  /* --- styles (RIGHT side, bottom-right by default, hide when open) --- */
  const css = document.createElement('style');
  css.textContent = `
  :root{--mn-red:#C22636;--mn-dark:#0b1220;--mn-ring:#e5e8f0}
  .mn-fab{
    position:fixed; right:16px; left:auto; bottom:24px;
    z-index:10090; display:flex; align-items:center; gap:10px;
    background:linear-gradient(90deg,var(--mn-red),#971B29); color:#fff;
    border:0; border-radius:999px; padding:12px 16px; font-weight:900; cursor:pointer;
    box-shadow:0 12px 28px rgba(194,38,54,.35);
    transition:opacity .2s ease, transform .2s ease;
  }
  /* Hide the FAB while the dialog is open */
  .mn-fab[aria-expanded="true"]{ display:none; }

  .mn-fab svg{ width:18px; height:18px; flex:0 0 auto }

  .mn-overlay{ position:fixed; inset:0; display:none; z-index:10089;
    background:rgba(9,16,28,.55); backdrop-filter:blur(6px); padding:16px;
  }
  .mn-overlay[aria-hidden="false"]{ display:block }
  /* Sheet on the right */
  .mn-sheet{
    position:absolute; right:16px; left:auto; top:50%; transform:translateY(-50%);
    width:min(360px,92vw); background:#fff; border:1px solid var(--mn-ring);
    border-radius:16px; box-shadow:0 24px 80px rgba(0,0,0,.35); overflow:hidden;
  }
  .mn-head{ background:#101826; color:#EAF2FF; padding:12px 14px; display:flex; justify-content:space-between; align-items:center }
  .mn-title{ font-weight:900 }
  .mn-close{ background:transparent; border:0; color:#EAF2FF; font-size:20px; cursor:pointer }
  .mn-body{ padding:14px; display:grid; gap:10px }
  .mn-field{ display:grid; gap:6px }
  .mn-input, .mn-textarea{
    width:100%; padding:12px; border-radius:12px; border:1px solid var(--mn-ring); background:#fff;
  }
  .mn-textarea{ min-height:96px; resize:vertical }
  .mn-err{ color:#b42318; font-weight:800; display:none; font-size:13px }
  .mn-err.show{ display:block }
  .mn-actions{ padding:12px 14px 16px; display:flex; gap:10px; justify-content:flex-end }
  .mn-btn{ appearance:none; border-radius:12px; padding:10px 14px; font-weight:900; cursor:pointer }
  .mn-ghost{ background:#fff; border:1px solid var(--mn-ring); color:var(--mn-dark) }
  .mn-primary{ background:linear-gradient(90deg,var(--mn-red),#971B29); color:#fff; border:0; box-shadow:0 10px 24px rgba(194,38,54,.28) }
  .mn-step{ display:none } .mn-step.active{ display:block; }

  /* mobile: keep at bottom-right, center the sheet */
  @media (max-width: 680px){
    .mn-fab{ right:14px; bottom:14px; }
    .mn-sheet{ right:auto; left:50%; transform:translate(-50%,-50%); }
  }`;
  document.head.appendChild(css);

  /* --- HTML --- */
  const wrap = document.createElement('div');
  wrap.innerHTML = `
    <button id="mnFab" class="mn-fab" type="button" aria-controls="mnOverlay" aria-expanded="false">
      <svg viewBox="0 0 24 24" fill="none"><path d="M21 12c0 4.418-4.03 8-9 8a9.77 9.77 0 0 1-3.56-.66L3 20l.86-4.3A7.74 7.74 0 0 1 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
      Message Now
    </button>

    <div id="mnOverlay" class="mn-overlay" aria-hidden="true" role="dialog" aria-modal="true">
      <div class="mn-sheet" role="document">
        <header class="mn-head">
          <div class="mn-title">Message Our Team</div>
          <button id="mnClose" class="mn-close" aria-label="Close">×</button>
        </header>

        <main class="mn-body">
          <!-- Step 1 -->
          <section id="mnStep1" class="mn-step active" data-step="1">
            <div class="mn-field">
              <label for="mnName"><strong>Name *</strong></label>
              <input id="mnName" class="mn-input" type="text" autocomplete="name" placeholder="Your name">
            </div>
            <div class="mn-field">
              <label for="mnPhone"><strong>Mobile (US & Canada) *</strong></label>
              <input id="mnPhone" class="mn-input" type="tel" inputmode="tel" placeholder="(xxx) xxx-xxxx" autocomplete="tel">
            </div>
            <div class="mn-field">
              <label for="mnMsg"><strong>Your Message *</strong></label>
              <textarea id="mnMsg" class="mn-textarea" placeholder="How can we help?"></textarea>
            </div>
            <div id="mnErr" class="mn-err"></div>
          </section>

          <!-- Step 2 -->
          <section id="mnStep2" class="mn-step" data-step="2">
            <p style="margin:0 0 6px; font-weight:900; font-size:18px">Thanks!</p>
            <p style="margin:0">A member of the team will reach out to you shortly.</p>
          </section>
        </main>

        <footer class="mn-actions">
          <button id="mnCancel" class="mn-btn mn-ghost" type="button">Cancel</button>
          <button id="mnSend" class="mn-btn mn-primary" type="button">Text Now</button>
        </footer>
      </div>
    </div>
  `;
  document.body.appendChild(wrap);

  /* --- wiring --- */
  const fab   = $('#mnFab');
  const ovl   = $('#mnOverlay');
  const close = $('#mnClose');
  const cancel= $('#mnCancel');
  const send  = $('#mnSend');
  const s1    = $('#mnStep1');
  const s2    = $('#mnStep2');
  const nameI = $('#mnName');
  const phoneI= $('#mnPhone');
  const msgI  = $('#mnMsg');
  const errEl = $('#mnErr');

  const last = getLS('mn_last', {name:'', phone:'', msg:''});
  if (last.name)  nameI.value  = last.name;
  if (last.phone) phoneI.value = maskPhone(last.phone);
  if (last.msg)   msgI.value   = last.msg;

  const open = () => { ovl.setAttribute('aria-hidden','false'); fab.setAttribute('aria-expanded','true'); nameI.focus(); };
  const hide = () => { ovl.setAttribute('aria-hidden','true'); fab.setAttribute('aria-expanded','false'); showStep(1); errEl.classList.remove('show'); errEl.textContent=''; };
  const showStep = (n) => { (n===1?s2:s1).classList.remove('active'); (n===1?s1:s2).classList.add('active'); send.textContent = n===1 ? 'Text Now' : 'Close'; };

  fab.addEventListener('click', open);
  close.addEventListener('click', hide);
  cancel.addEventListener('click', hide);
  ovl.addEventListener('click', e=>{ if (e.target === ovl) hide(); });
  window.addEventListener('keydown', e=>{ if (e.key==='Escape' && ovl.getAttribute('aria-hidden')==='false') hide(); });

  phoneI.addEventListener('input', ()=>{
    const pos = phoneI.selectionStart || 0;
    phoneI.value = maskPhone(phoneI.value);
    try{ phoneI.setSelectionRange(pos,pos); }catch(_){}
  }, {capture:true});

  send.addEventListener('click', async ()=>{
    if (s2.classList.contains('active')) { hide(); return; }

    const name   = (nameI.value || '').trim();
    const phoneD = digits(phoneI.value).replace(/^1/,'');
    const msg    = (msgI.value || '').trim();

    setLS('mn_last', {name, phone: phoneD, msg});

    const problems = [];
    if (!name) problems.push('Enter your name.');
    if (phoneD.length < 10) problems.push('Enter a valid 10-digit mobile number.');
    if (!msg) problems.push('Please add a short message.');
    if (problems.length){
      errEl.textContent = problems.join(' ');
      errEl.classList.add('show');
      return;
    }
    errEl.classList.remove('show'); errEl.textContent='';

    // Optional: send to backend
    // await fetch('/api/message-now', { method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify({name, phone:phoneD, message:msg, source:'message-now'}) });

    showStep(2);
  });

  /* --- NEW: keep FAB just ABOVE the Winter sticky widget --- */
  (function keepFabAboveWinter(){
    const WinterSelectors = [
      '#WinterModal', '.Winter-stick', '.Winter-sticky', '.WinterCard', '.Winter-bonus',
      '[data-widget*="Winter"]', '#offerTunnel' // add/keep your Winter ids/classes here
    ];
    const pickWinter = ()=>WinterSelectors.map(s=>document.querySelector(s)).find(Boolean);

    function place(){
      // default bottom spacing when no Winter is visible
      fab.style.bottom = '24px';
      fab.style.top = ''; // ensure top isn't set

      const Winter = pickWinter();
      if (!Winter || Winter.offsetParent === null) return;

      const vRect = Winter.getBoundingClientRect();
      const gap = 16;

      // If Winter is pinned near the bottom, stack the FAB above it
      const needStack = (window.innerHeight - vRect.bottom) < 160;
      if (needStack) {
        const bottomOffset = Math.max(24, (window.innerHeight - vRect.top) + gap);
        fab.style.bottom = bottomOffset + 'px';
      } else {
        // Winter sits higher on the side; align just above its top
        const fabH = fab.getBoundingClientRect().height || 48;
        const top = Math.max(16, vRect.top - fabH - gap);
        fab.style.top = top + 'px';
        fab.style.bottom = '';
      }
    }

    // react to layout / visibility changes
    const ro = new ResizeObserver(place);
    ro.observe(document.documentElement);
    const mo = new MutationObserver(place);
    mo.observe(document.documentElement, {childList:true, subtree:true, attributes:true, attributeFilter:['style','class','aria-hidden']});
    window.addEventListener('resize', place, {passive:true});
    window.addEventListener('scroll', place, {passive:true});

    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', place);
    } else {
      place();
    }

    // expose manual trigger if needed
    window.repositionMessageNow = place;
  })();
})();
</script>



<script>
(function(){
  const vp = document.getElementById('invViewport');
  const track = document.getElementById('invTrack');
  const prev = document.querySelector('#inventory .fvx-prev');
  const next = document.querySelector('#inventory .fvx-next');

  function step(dir){ vp.scrollBy({left: dir * Math.round(vp.clientWidth * .9), behavior:'smooth'}); }
  prev?.addEventListener('click', ()=>step(-1));
  next?.addEventListener('click', ()=>step(1));

  async function loadInventory(limit=12){
    try{
      const res = await fetch(`/api/inventory?limit=${limit}`, { cache:'no-store' });
      const { items = [] } = await res.json();
      if (!items.length) throw new Error('No items');
      for (const v of items){
        const li = document.createElement('li');
        li.className = 'fvx-card';
        li.innerHTML = `
          <figure class="fvx-media">
            <img loading="lazy" src="${v.image}" alt="${v.title}">
            <span class="fvx-badge">used</span>
          </figure>
          <div class="fvx-body">
            <h3 class="fvx-title">${v.title}</h3>
            ${v.kms ? `<p class="fvx-trim">${Number(v.kms).toLocaleString()} KM${v.stock?` • Stock ${v.stock}`:''}</p>` : (v.stock?`<p class="fvx-trim">Stock ${v.stock}</p>`:'')}
            <div class="fvx-price">
              <div class="fvx-pay"><strong>${v.price || 'Ask'}</strong><small>Sale</small></div>
              <div class="fvx-sale"><span class="label">Get this car</span><span class="value">Schedule now</span></div>
            </div>
            <div class="fvx-actions">
              <a class="fvx-btn shop" href="#offertunnel">Schedule Now</a>
              <a class="fvx-btn approve" href="#offertunnel">I’m Interested</a>
            </div>
          </div>`;
        // Whole card click → schedule flow
        li.addEventListener('click', (e) => {
          const isBtn = e.target.closest('a,button');
          e.preventDefault();
          if (!isBtn) window.openOfferTunnel?.();
        });
        track.appendChild(li);
      }
    } catch {
      const li = document.createElement('li');
      li.className = 'fvx-card';
      li.innerHTML = `<div class="fvx-body"><h3 class="fvx-title">Inventory unavailable</h3><p class="fvx-trim">Please try again shortly.</p></div>`;
      track.appendChild(li);
    }
  }

  // Hijack your top “Inventory” nav to load + scroll here
  document.addEventListener('click', (e) => {
    const link = e.target.closest('[data-inventory-link]');
    if (!link) return;
    e.preventDefault();
    document.getElementById('inventory')?.scrollIntoView({ behavior:'smooth' });
    loadInventory(16);
  }, true);

  // Lazy-load when section first becomes visible
  const io = new IntersectionObserver((entries)=>{
    if (entries.some(en=>en.isIntersecting)) { loadInventory(12); io.disconnect(); }
  }, { rootMargin:'200px' });
  io.observe(document.getElementById('inventory'));

  // Make all inner buttons open your scheduler
  track.addEventListener('click', (e) => {
    if (e.target.closest('a')) { e.preventDefault(); window.openOfferTunnel?.(); }
  });
})();
</script>

</body>
</html>
